"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.parseSolidityFileArg = parseSolidityFileArg;
exports.Solidity = void 0;

var _dev = require("../dev");

var _utils = require("../utils/utils");

var _clientCode = require("./client-code");

var _job = require("./job");

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const fs = require('fs');

function parseSolidityFileArg(fileArg, fileMustExists) {
  const parsed = (0, _utils.parseFileArg)(fileArg, '.sol', fileMustExists);
  return {
    dir: parsed.dir,
    name: {
      base: parsed.base,
      sol: parsed.name,
      tvc: `${parsed.base}.tvc`,
      code: `${parsed.base}.code`,
      abi: `${parsed.base}.abi.json`,
      package: `${parsed.base}Package`,
      result: `${parsed.base}.result`
    }
  };
}

class Solidity {
  static async build(dev, files, options) {
    const sol = new Solidity(dev, files, options);
    await sol.build();
  }

  constructor(dev, files, options) {
    _defineProperty(this, "dev", void 0);

    _defineProperty(this, "files", void 0);

    _defineProperty(this, "options", void 0);

    this.dev = dev;
    this.files = files;
    this.options = options;
  }

  async build() {
    for (let i = 0; i < this.files.length; i += 1) {
      const file = parseSolidityFileArg(this.files[i], true);
      const job = await _job.CompilersJob.create(this.dev, file.dir());
      this.prepareBuildBatch(file, job);
      await job.run('sh', job.guestPath('job.sh'));
      this.cleanBuildResults(file, job);
      await _clientCode.ClientCode.generate([this.files[i]], this.options);
    }
  }

  prepareBuildBatchForFie(file, batch) {
    const {
      name
    } = file;
    batch.push(`solc ${name.sol} --tvm > ${name.code}`, `solc ${name.sol} --tvm_abi > ${name.abi}`, `tvm_linker compile ${name.code} --lib /usr/bin/stdlib_sol.tvm --abi-json ${name.abi} > ${name.result}`);
  }

  prepareBuildBatch(file, job) {
    const batch = [];
    batch.push(`cd ${job.guestPath()}`);
    this.prepareBuildBatchForFie(file, batch);
    fs.writeFileSync(job.hostPath('job.sh'), batch.join('\n'));
  }

  cleanBuildResults(file, job) {
    const {
      name
    } = file;
    const linkerResult = fs.readFileSync(job.hostPath(name.result), {
      encoding: 'utf8'
    });
    const tvcFile = (/Saved contract to file\s*(.*\.tvc)/gi.exec(linkerResult) || [])[1];

    if (!tvcFile) {
      console.log(linkerResult);
      process.exit(1);
    }

    fs.renameSync(job.hostPath(tvcFile), job.hostPath(name.tvc));
    fs.unlinkSync(job.hostPath('job.sh'));
    fs.unlinkSync(job.hostPath(name.result));
    fs.unlinkSync(job.hostPath(name.code));
  }

}

exports.Solidity = Solidity;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21waWxlcnMvc29saWRpdHkuanMiXSwibmFtZXMiOlsiZnMiLCJyZXF1aXJlIiwicGFyc2VTb2xpZGl0eUZpbGVBcmciLCJmaWxlQXJnIiwiZmlsZU11c3RFeGlzdHMiLCJwYXJzZWQiLCJkaXIiLCJuYW1lIiwiYmFzZSIsInNvbCIsInR2YyIsImNvZGUiLCJhYmkiLCJwYWNrYWdlIiwicmVzdWx0IiwiU29saWRpdHkiLCJidWlsZCIsImRldiIsImZpbGVzIiwib3B0aW9ucyIsImNvbnN0cnVjdG9yIiwiaSIsImxlbmd0aCIsImZpbGUiLCJqb2IiLCJDb21waWxlcnNKb2IiLCJjcmVhdGUiLCJwcmVwYXJlQnVpbGRCYXRjaCIsInJ1biIsImd1ZXN0UGF0aCIsImNsZWFuQnVpbGRSZXN1bHRzIiwiQ2xpZW50Q29kZSIsImdlbmVyYXRlIiwicHJlcGFyZUJ1aWxkQmF0Y2hGb3JGaWUiLCJiYXRjaCIsInB1c2giLCJ3cml0ZUZpbGVTeW5jIiwiaG9zdFBhdGgiLCJqb2luIiwibGlua2VyUmVzdWx0IiwicmVhZEZpbGVTeW5jIiwiZW5jb2RpbmciLCJ0dmNGaWxlIiwiZXhlYyIsImNvbnNvbGUiLCJsb2ciLCJwcm9jZXNzIiwiZXhpdCIsInJlbmFtZVN5bmMiLCJ1bmxpbmtTeW5jIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQWlCQTs7QUFFQTs7QUFFQTs7QUFDQTs7OztBQUVBLE1BQU1BLEVBQUUsR0FBR0MsT0FBTyxDQUFDLElBQUQsQ0FBbEI7O0FBaUJPLFNBQVNDLG9CQUFULENBQThCQyxPQUE5QixFQUErQ0MsY0FBL0MsRUFBeUY7QUFDNUYsUUFBTUMsTUFBTSxHQUFHLHlCQUFhRixPQUFiLEVBQXNCLE1BQXRCLEVBQThCQyxjQUE5QixDQUFmO0FBQ0EsU0FBTztBQUNIRSxJQUFBQSxHQUFHLEVBQUVELE1BQU0sQ0FBQ0MsR0FEVDtBQUVIQyxJQUFBQSxJQUFJLEVBQUU7QUFDRkMsTUFBQUEsSUFBSSxFQUFFSCxNQUFNLENBQUNHLElB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SU9OUyBMVEQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIFNPRlRXQVJFIEVWQUxVQVRJT04gTGljZW5zZSAodGhlIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlXG4gKiB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGVcbiAqIExpY2Vuc2UgYXQ6IGh0dHBzOi8vd3d3LnRvbi5kZXYvbGljZW5zZXNcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIFRPTiBERVYgc29mdHdhcmUgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKlxuICovXG4vLyBAZmxvd1xuXG5cbmltcG9ydCB7IERldiB9IGZyb20gXCIuLi9kZXZcIjtcbmltcG9ydCB0eXBlIHsgUGF0aEpvaW4gfSBmcm9tIFwiLi4vdXRpbHMvdXRpbHNcIjtcbmltcG9ydCB7IHBhcnNlRmlsZUFyZyB9IGZyb20gXCIuLi91dGlscy91dGlsc1wiO1xuaW1wb3J0IHR5cGUgeyBDbGllbnRDb2RlT3B0aW9ucyB9IGZyb20gXCIuL2NsaWVudC1jb2RlXCI7XG5pbXBvcnQgeyBDbGllbnRDb2RlIH0gZnJvbSBcIi4vY2xpZW50LWNvZGVcIjtcbmltcG9ydCB7IENvbXBpbGVyc0pvYiB9IGZyb20gXCIuL2pvYlwiO1xuXG5jb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG5cbmV4cG9ydCB0eXBlIFNvbGlkaXR5QnVpbGRPcHRpb25zID0gQ2xpZW50Q29kZU9wdGlvbnM7XG5cbnR5cGUgU29saWRpdHlGaWxlQXJnID0ge1xuICAgIGRpcjogUGF0aEpvaW4sXG4gICAgbmFtZToge1xuICAgICAgICBiYXNlOiBzdHJpbmcsXG4gICAgICAgIHNvbDogc3RyaW5nLFxuICAgICAgICB0dmM6IHN0cmluZyxcbiAgICAgICAgY29kZTogc3RyaW5nLFxuICAgICAgICBhYmk6IHN0cmluZyxcbiAgICAgICAgcGFja2FnZTogc3RyaW5nLFxuICAgICAgICByZXN1bHQ6IHN0cmluZyxcbiAgICB9LFxufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VTb2xpZGl0eUZpbGVBcmcoZmlsZUFyZzogc3RyaW5nLCBmaWxlTXVzdEV4aXN0czogYm9vbGVhbik6IFNvbGlkaXR5RmlsZUFyZyB7XG4gICAgY29uc3QgcGFyc2VkID0gcGFyc2VGaWxlQXJnKGZpbGVBcmcsICcuc29sJywgZmlsZU11c3RFeGlzdHMpO1xuICAgIHJldHVybiB7XG4gICAgICAgIGRpcjogcGFyc2VkLmRpcixcbiAgICAgICAgbmFtZToge1xuICAgICAgICAgICAgYmFzZTogcGFyc2VkLmJhc2UsXG4gICAgICAgICAgICBzb2w6IHBhcnNlZC5uYW1lLFxuICAgICAgICAgICAgdHZjOiBgJHtwYXJzZWQuYmFzZX0udHZjYCxcbiAgICAgICAgICAgIGNvZGU6IGAke3BhcnNlZC5iYXNlfS5jb2RlYCxcbiAgICAgICAgICAgIGFiaTogYCR7cGFyc2VkLmJhc2V9LmFiaS5qc29uYCxcbiAgICAgICAgICAgIHBhY2thZ2U6IGAke3BhcnNlZC5iYXNlfVBhY2thZ2VgLFxuICAgICAgICAgICAgcmVzdWx0OiBgJHtwYXJzZWQuYmFzZX0ucmVzdWx0YCxcbiAgICAgICAgfSxcbiAgICB9O1xufVxuXG5leHBvcnQgY2xhc3MgU29saWRpdHkge1xuICAgIHN0YXRpYyBhc3luYyBidWlsZChkZXY6IERldiwgZmlsZXM6IHN0cmluZ1tdLCBvcHRpb25zOiBTb2xpZGl0eUJ1aWxkT3B0aW9ucykge1xuICAgICAgICBjb25zdCBzb2wgPSBuZXcgU29saWRpdHkoZGV2LCBmaWxlcywgb3B0aW9ucyk7XG4gICAgICAgIGF3YWl0IHNvbC5idWlsZCgpO1xuICAgIH1cblxuICAgIGRldjogRGV2O1xuICAgIGZpbGVzOiBzdHJpbmdbXTtcbiAgICBvcHRpb25zOiBTb2xpZGl0eUJ1aWxkT3B0aW9ucztcblxuICAgIGNvbnN0cnVjdG9yKGRldjogRGV2LCBmaWxlczogc3RyaW5nW10sIG9wdGlvbnM6IFNvbGlkaXR5QnVpbGRPcHRpb25zKSB7XG4gICAgICAgIHRoaXMuZGV2ID0gZGV2O1xuICAgICAgICB0aGlzLmZpbGVzID0gZmlsZXM7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgfVxuXG4gICAgYXN5bmMgYnVpbGQoKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5maWxlcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgY29uc3QgZmlsZSA9IHBhcnNlU29saWRpdHlGaWxlQXJnKHRoaXMuZmlsZXNbaV0sIHRydWUpO1xuICAgICAgICAgICAgY29uc3Qgam9iID0gYXdhaXQgQ29tcGlsZXJzSm9iLmNyZWF0ZSh0aGlzLmRldiwgZmlsZS5kaXIoKSk7XG4gICAgICAgICAgICB0aGlzLnByZXBhcmVCdWlsZEJhdGNoKGZpbGUsIGpvYik7XG4gICAgICAgICAgICBhd2FpdCBqb2IucnVuKCdzaCcsIGpvYi5ndWVzdFBhdGgoJ2pvYi5zaCcpKTtcbiAgICAgICAgICAgIHRoaXMuY2xlYW5CdWlsZFJlc3VsdHMoZmlsZSwgam9iKTtcbiAgICAgICAgICAgIGF3YWl0IENsaWVudENvZGUuZ2VuZXJhdGUoW3RoaXMuZmlsZXNbaV1dLCB0aGlzLm9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJlcGFyZUJ1aWxkQmF0Y2hGb3JGaWUoZmlsZTogU29saWRpdHlGaWxlQXJnLCBiYXRjaDogc3RyaW5nW10pIHtcbiAgICAgICAgY29uc3QgeyBuYW1lIH0gPSBmaWxlO1xuICAgICAgICBiYXRjaC5wdXNoKFxuICAgICAgICAgICAgYHNvbGMgJHtuYW1lLnNvbH0gLS10dm0gPiAke25hbWUuY29kZX1gLFxuICAgICAgICAgICAgYHNvbGMgJHtuYW1lLnNvbH0gLS10dm1fYWJpID4gJHtuYW1lLmFiaX1gLFxuICAgICAgICAgICAgYHR2bV9saW5rZXIgY29tcGlsZSAke25hbWUuY29kZX0gLS1saWIgL3Vzci9iaW4vc3RkbGliX3NvbC50dm0gLS1hYmktanNvbiAke25hbWUuYWJpfSA+ICR7bmFtZS5yZXN1bHR9YFxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByZXBhcmVCdWlsZEJhdGNoKGZpbGU6IFNvbGlkaXR5RmlsZUFyZywgam9iOiBDb21waWxlcnNKb2IpIHtcbiAgICAgICAgY29uc3QgYmF0Y2ggPSBbXTtcbiAgICAgICAgYmF0Y2gucHVzaChgY2QgJHtqb2IuZ3Vlc3RQYXRoKCl9YCk7XG4gICAgICAgIHRoaXMucHJlcGFyZUJ1aWxkQmF0Y2hGb3JGaWUoZmlsZSwgYmF0Y2gpO1xuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKGpvYi5ob3N0UGF0aCgnam9iLnNoJyksIGJhdGNoLmpvaW4oJ1xcbicpKTtcbiAgICB9XG5cbiAgICBjbGVhbkJ1aWxkUmVzdWx0cyhmaWxlOiBTb2xpZGl0eUZpbGVBcmcsIGpvYjogQ29tcGlsZXJzSm9iKSB7XG4gICAgICAgIGNvbnN0IHsgbmFtZSB9ID0gZmlsZTtcbiAgICAgICAgY29uc3QgbGlua2VyUmVzdWx0ID0gZnMucmVhZEZpbGVTeW5jKGpvYi5ob3N0UGF0aChuYW1lLnJlc3VsdCksIHsgZW5jb2Rpbmc6ICd1dGY4JyB9KTtcbiAgICAgICAgY29uc3QgdHZjRmlsZSA9ICgvU2F2ZWQgY29udHJhY3QgdG8gZmlsZVxccyooLipcXC50dmMpL2dpLmV4ZWMobGlua2VyUmVzdWx0KSB8fCBbXSlbMV07XG4gICAgICAgIGlmICghdHZjRmlsZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2cobGlua2VyUmVzdWx0KTtcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKVxuICAgICAgICB9XG4gICAgICAgIGZzLnJlbmFtZVN5bmMoam9iLmhvc3RQYXRoKHR2Y0ZpbGUpLCBqb2IuaG9zdFBhdGgobmFtZS50dmMpKTtcbiAgICAgICAgZnMudW5saW5rU3luYyhqb2IuaG9zdFBhdGgoJ2pvYi5zaCcpKTtcbiAgICAgICAgZnMudW5saW5rU3luYyhqb2IuaG9zdFBhdGgobmFtZS5yZXN1bHQpKTtcbiAgICAgICAgZnMudW5saW5rU3luYyhqb2IuaG9zdFBhdGgobmFtZS5jb2RlKSk7XG4gICAgfVxufVxuIl19