"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.handleCommandLine = handleCommandLine;

var _tonClientNodeJs = require("ton-client-node-js");

var _clientCode = require("../compilers/client-code");

var _solidity = require("../compilers/solidity");

var _dev2 = require("../dev");

var _networks = require("../networks/networks");

var _server = require("../server/server");

var _options = require("./options");

var _info = require("./info.js");

var _spy = require("./spy");

var _commander = require("commander");

/*
 * Copyright 2018-2020 TON DEV SOLUTIONS LTD.
 *
 * Licensed under the SOFTWARE EVALUATION License (the "License"); you may not use
 * this file except in compliance with the License.  You may obtain a copy of the
 * License at: https://www.ton.dev/licenses
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific TON DEV software governing permissions and
 * limitations under the License.
 *
 */
const USE_EXPERIMENTAL_FEATURES = false;

async function setupCommand(dev, options) {
  await dev.start((0, _options.compilersWithNetworks)(dev, options));
}

async function startCommand(dev, options) {
  await dev.start((0, _options.compilersWithNetworks)(dev, options));
}

async function stopCommand(dev, options) {
  await dev.stop((0, _options.compilersWithNetworks)(dev, options));
}

async function restartCommand(dev, options) {
  await dev.restart((0, _options.compilersWithNetworks)(dev, options));
}

async function recreateCommand(dev, options) {
  await dev.recreate((0, _options.compilersWithNetworks)(dev, options));
}

async function cleanCommand(dev, options) {
  const all = !options.compilers && !options.networks;
  await dev.clean(options.compilers || all, options.networks || all, options.containers);
}

async function setCommand(dev, names, options) {
  await dev.updateNetworkConfigs(dev.networksOrAll(names), config => {
    if (options.newName) {
      config.name = options.newName;
    }

    if (options.port) {
      config.hostPort = options.port;
    }

    if (options.dbPort) {
      if (options.dbPort === 'bind') {
        config.arangoHostPort = _networks.Network.defaultArangoPort;
      } else if (options.dbPort === 'unbind') {
        config.arangoHostPort = '';
      } else {
        config.arangoHostPort = options.dbPort || '';
      }
    }
  });
}

async function addCommand(dev, names) {
  await dev.addNetworks(names);
}

async function removeCommand(dev, names) {
  await dev.removeNetworks(dev.networksFromNames(names));
}

async function generateKeysCommand(_dev) {
  const client = await _tonClientNodeJs.TONClient.create({
    servers: ['http://localhost']
  });
  const keys = await client.crypto.ed25519Keypair();
  console.log(JSON.stringify(keys, undefined, 4));
}

async function convertAddress(_dev, addr) {
  const client = await _tonClientNodeJs.TONClient.create({
    servers: ['http://localhost']
  });

  const showConverted = (title, converted) => {
    console.log(`${converted.address === addr ? 'âœ“' : ' '} ${title} = ${converted.address}`);
  };

  const showHex = async () => {
    const converted = await client.contracts.convertAddress({
      address: addr,
      convertTo: 'Hex'
    });
    showConverted('hex', converted);
  };

  const showBase64 = async (test, bounce, url) => {
    const converted = await client.contracts.convertAddress({
      address: addr,
      convertTo: 'Base64',
      base64Params: {
        bounce,
        test,
        url
      }
    });
    const flags = [test ? 'test' : 'main', bounce ? 'bounce' : '', url ? 'url' : ''].filter(x => x !== '').join(' ');
    showConverted(flags, converted);
  };

  await showHex();
  await showBase64(false, false, false);
  await showBase64(false, false, true);
  await showBase64(false, true, false);
  await showBase64(false, true, true);
  await showBase64(true, false, false);
  await showBase64(true, false, true);
  await showBase64(true, true, false);
  await showBase64(true, true, true);
}

async function useCommand(dev, version, options) {
  await dev.useVersion(version, (0, _options.compilersWithNetworks)(dev, options));
}

async function solCommand(dev, files, options) {
  if (files.length < 1) {
    throw new Error('You must specify at least one file name');
  }

  await _solidity.Solidity.build(dev, files, {
    clientLanguages: (options.clientLanguages || '').split(',').filter(x => x),
    clientLevel: options.clientLevel || _clientCode.ClientCodeLevel.run,
    jsModule: options.jsModule || _clientCode.JSModule.node
  });
}

async function genCommand(dev, files, options) {
  if (files.length < 1) {
    throw new Error('You must specify at least one file name');
  }

  await _clientCode.ClientCode.generate(files, {
    clientLanguages: (options.clientLanguages || '').split(','),
    clientLevel: options.clientLevel || _clientCode.ClientCodeLevel.run,
    jsModule: options.jsModule || _clientCode.JSModule.node
  });
}

async function spyCommand(dev, networks) {
  await (0, _spy.spy)(dev, networks);
}

async function webConsoleCommand(dev, options) {
  await (0, _server.web)(dev, options);
}

const networksOption = ['-n, --networks [names]', 'Apply command to specified network[s] (names must be separated with comma).'];
const compilersOption = ['-m, --compilers', 'Apply command to the compilers container.'];

function getSupportedLanguages() {
  return Object.values(_clientCode.ClientCode.languages).map(x => x.shortName);
}

const clientLanguagesOption = ['-l, --client-languages <languages>', `Generate client code for specified languages separated by comma, ` + `supported languages: "${getSupportedLanguages().join('", "')}".`];
const clientLevelOption = ['-L, --client-level <client-level>', 'Client code level: ' + '"run" to run only, ' + '"deploy" to run and deploy (includes an imageBase64 of binary contract)', 'deploy'];
const jsModuleTypeOption = ['--js-module <module-type>', "Java Script module type: " + "`node` to use with `const FooContract = require('foo')`, " + "`nodeNoDefault` to use with `const {FooContract} = require('foo')`, " + "`es` to use with `import FooContract from 'foo'`, " + "`esNoDefault` to use with `import {FooContract} from 'foo'`.", 'node'];

async function handleCommandLine(dev, args) {
  const program = new _commander.Command();
  let commandAction = _info.infoCommand;
  let commandArgs = [];

  const command = action => {
    return (...args) => {
      commandAction = action;
      commandArgs = args;
    };
  };

  program.name(dev.name).version(dev.version).option('-a, --available', 'Show available versions.').description('TON Labs development tools');
  program.command('info', {
    isDefault: true
  }).description('Show summary about dev environment.').option('-a, --available', 'Show available versions.').action(command(_info.infoCommand));
  program.command('sol [files...]').description('Build solidity contract[s].').option(...clientLanguagesOption).option(...clientLevelOption).option(...jsModuleTypeOption).action(command(solCommand));
  program.command('gen [files...]').description('Generate client code for contract[s].').option(clientLanguagesOption[0], clientLanguagesOption[1], 'js').option(...clientLevelOption).option(...jsModuleTypeOption).action(command(genCommand));
  program.command('start').description('Start dev containers.').option(...networksOption).option(...compilersOption).action(command(startCommand));
  program.command('stop').description('Stop dev containers.').option(...networksOption).option(...compilersOption).action(command(stopCommand));
  program.command('restart').description('Restart dev containers.').option(...networksOption).option(...compilersOption).action(command(restartCommand));
  program.command('recreate').description('Recreate dev containers.').option(...networksOption).option(...compilersOption).action(command(recreateCommand));
  program.command('setup').description('Setup dev environment.').option(...networksOption).option(...compilersOption).action(command(setupCommand));
  program.command('clean').description('Remove docker containers and images related to TON Dev.').option('-n, --networks', 'Clean local node docker containers and images.').option('-m, --compilers', 'Clean compilers docker containers and images.').option('-c, --containers', 'Clean containers only.', false).action(command(cleanCommand));
  program.command('use <version>').description('Use specified version for containers.').option(...networksOption).option(...compilersOption).action(command(useCommand));
  program.command('set [network...]').description('Set network[s] options.').option('-p, --port <port>', 'Host port to bound local node.').option('-d, --db-port <binding>', 'Host port to bound local nodes Arango DB ("bind" to use default Arango DB port, "unbind" to unbind Arango DB port).').option('-n, --new-name <name>', 'Set new name for network.').action(command(setCommand));
  program.command('add [network...]').description('Add network[s].').action(command(addCommand));
  program.command('remove [network...]').alias('rm').description('Remove network[s].').action(command(removeCommand));
  program.command('keys').alias('k').description('Generate random Key Pair.').action(command(generateKeysCommand));
  program.command('addr <addr>').alias('a').description('Convert address.').action(command(convertAddress)).allowUnknownOption(true);

  if (USE_EXPERIMENTAL_FEATURES) {
    program.command('spy [networks...]').description('Run network scanner.').action(command(spyCommand));
    program.command('web').description('Run web console.').option('-p, --port <port>', 'Host port to bound web console.', '8800').action(command(webConsoleCommand));
  }

  program.parse(args);

  if (commandArgs.length === 0) {
    if (program.args.length === 0) {
      await (0, _info.infoCommand)(dev, program);
    } else {
      program.outputHelp();
    }
  } else {
    if (commandAction === _info.infoCommand) {
      const options = commandArgs[commandArgs.length - 1];
      options.available = options.parent.available;
    }

    await commandAction(dev, ...commandArgs);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jbGkvY2xpLmpzIl0sIm5hbWVzIjpbIlVTRV9FWFBFUklNRU5UQUxfRkVBVFVSRVMiLCJzZXR1cENvbW1hbmQiLCJkZXYiLCJvcHRpb25zIiwic3RhcnQiLCJzdGFydENvbW1hbmQiLCJzdG9wQ29tbWFuZCIsInN0b3AiLCJyZXN0YXJ0Q29tbWFuZCIsInJlc3RhcnQiLCJyZWNyZWF0ZUNvbW1hbmQiLCJyZWNyZWF0ZSIsImNsZWFuQ29tbWFuZCIsImFsbCIsImNvbXBpbGVycyIsIm5ldHdvcmtzIiwiY2xlYW4iLCJjb250YWluZXJzIiwic2V0Q29tbWFuZCIsIm5hbWVzIiwidXBkYXRlTmV0d29ya0NvbmZpZ3MiLCJuZXR3b3Jrc09yQWxsIiwiY29uZmlnIiwibmV3TmFtZSIsIm5hbWUiLCJwb3J0IiwiaG9zdFBvcnQiLCJkYlBvcnQiLCJhcmFuZ29Ib3N0UG9ydCIsIk5ldHdvcmsiLCJkZWZhdWx0QXJhbmdvUG9ydCIsImFkZENvbW1hbmQiLCJhZGROZXR3b3JrcyIsInJlbW92ZUNvbW1hbmQiLCJyZW1vdmVOZXR3b3JrcyIsIm5ldHdvcmtzRnJvbU5hbWVzIiwiZ2VuZXJhdGVLZXlzQ29tbWFuZCIsIl9kZXYiLCJjbGllbnQiLCJUT05DbGllbnQiLCJjcmVhdGUiLCJzZXJ2ZXJzIiwia2V5cyIsImNyeXB0byIsImVkMjU1MTlLZXlwYWlyIiwiY29uc29sZSIsImxvZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1bmRlZmluZWQiLCJjb252ZXJ0QWRkcmVzcyIsImFkZHIiLCJzaG93Q29udmVydGVkIiwidGl0bGUiLCJjb252ZXJ0ZWQiLCJhZGRyZXNzIiwic2hvd0hleCIsImNvbnRyYWN0cyIsImNvbnZlcnRUbyIsInNob3dCYXNlNjQiLCJ0ZXN0IiwiYm91bmNlIiwidXJsIiwiYmFzZTY0UGFyYW1zIiwiZmxhZ3MiLCJmaWx0ZXIiLCJ4Iiwiam9pbiIsInVzZUNvbW1hbmQiLCJ2ZXJzaW9uIiwidXNlVmVyc2lvbiIsInNvbENvbW1hbmQiLCJmaWxlcyIsImxlbmd0aCIsIkVycm9yIiwiU29saWRpdHkiLCJidWlsZCIsImNsaWVudExhbmd1YWdlcyIsInNwbGl0IiwiY2xpZW50TGV2ZWwiLCJDbGllbnRDb2RlTGV2ZWwiLCJydW4iLCJqc01vZHVsZSIsIkpTTW9kdWxlIiwibm9kZSIsImdlbkNvbW1hbmQiLCJDbGllbnRDb2RlIiwiZ2VuZXJhdGUiLCJzcHlDb21tYW5kIiwid2ViQ29uc29sZUNvbW1hbmQiLCJuZXR3b3Jrc09wdGlvbiIsImNvbXBpbGVyc09wdGlvbiIsImdldFN1cHBvcnRlZExhbmd1YWdlcyIsIk9iamVjdCIsInZhbHVlcyIsImxhbmd1YWdlcyIsIm1hcCIsInNob3J0TmFtZSIsImNsaWVudExhbmd1YWdlc09wdGlvbiIsImNsaWVudExldmVsT3B0aW9uIiwianNNb2R1bGVUeXBlT3B0aW9uIiwiaGFuZGxlQ29tbWFuZExpbmUiLCJhcmdzIiwicHJvZ3JhbSIsIkNvbW1hbmQiLCJjb21tYW5kQWN0aW9uIiwiaW5mb0NvbW1hbmQiLCJjb21tYW5kQXJncyIsImNvbW1hbmQiLCJhY3Rpb24iLCJvcHRpb24iLCJkZXNjcmlwdGlvbiIsImlzRGVmYXVsdCIsImFsaWFzIiwiYWxsb3dVbmtub3duT3B0aW9uIiwicGFyc2UiLCJvdXRwdXRIZWxwIiwiYXZhaWxhYmxlIiwicGFyZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBZ0JBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQVdBOztBQUNBOztBQUNBOztBQXBDQTs7Ozs7Ozs7Ozs7Ozs7QUFzQ0EsTUFBTUEseUJBQXlCLEdBQUcsS0FBbEM7O0FBRUEsZUFBZUMsWUFBZixDQUE0QkMsR0FBNUIsRUFBc0NDLE9BQXRDLEVBQTZEO0FBQ3pELFFBQU1ELEdBQUcsQ0FBQ0UsS0FBSixDQUFVLG9DQUFzQkYsR0FBdEIsRUFBMkJDLE9BQTNCLENBQVYsQ0FBTjtBQUNIOztBQUdELGVBQWVFLFlBQWYsQ0FBNEJILEdBQTVCLEVBQXNDQyxPQUF0QyxFQUE2RDtB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Q29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMTgtMjAyMCBUT04gREVWIFNPTFVUSU9OUyBMVEQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIFNPRlRXQVJFIEVWQUxVQVRJT04gTGljZW5zZSAodGhlIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlXG4gKiB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGVcbiAqIExpY2Vuc2UgYXQ6IGh0dHBzOi8vd3d3LnRvbi5kZXYvbGljZW5zZXNcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIFRPTiBERVYgc29mdHdhcmUgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKlxuICovXG4vLyBAZmxvd1xuXG5pbXBvcnQgeyBUT05DbGllbnQgfSBmcm9tIFwidG9uLWNsaWVudC1ub2RlLWpzXCI7XG5pbXBvcnQgeyBDbGllbnRDb2RlLCBDbGllbnRDb2RlTGV2ZWwsIEpTTW9kdWxlIH0gZnJvbSBcIi4uL2NvbXBpbGVycy9jbGllbnQtY29kZVwiO1xuaW1wb3J0IHsgU29saWRpdHkgfSBmcm9tIFwiLi4vY29tcGlsZXJzL3NvbGlkaXR5XCI7XG5pbXBvcnQgeyBEZXYgfSBmcm9tIFwiLi4vZGV2XCI7XG5pbXBvcnQgeyBOZXR3b3JrIH0gZnJvbSBcIi4uL25ldHdvcmtzL25ldHdvcmtzXCI7XG5pbXBvcnQgdHlwZSB7IE5ldHdvcmtDb25maWcgfSBmcm9tIFwiLi4vbmV0d29ya3MvbmV0d29ya3NcIjtcbmltcG9ydCB7IHdlYiB9IGZyb20gXCIuLi9zZXJ2ZXIvc2VydmVyXCI7XG5pbXBvcnQgeyBjb21waWxlcnNXaXRoTmV0d29ya3MgfSBmcm9tIFwiLi9vcHRpb25zXCI7XG5pbXBvcnQgdHlwZSB7XG4gICAgQ2xlYW5PcHRpb25zLFxuICAgIFJlY3JlYXRlT3B0aW9ucyxcbiAgICBSZXN0YXJ0T3B0aW9ucywgU2V0TmV0d29ya09wdGlvbnMsXG4gICAgU2V0dXBPcHRpb25zLCBTb2xPcHRpb25zLFxuICAgIFN0YXJ0T3B0aW9ucyxcbiAgICBTdG9wT3B0aW9ucyxcbiAgICBVc2VPcHRpb25zLCBXZWJPcHRpb25zLFxufSBmcm9tIFwiLi9vcHRpb25zXCI7XG5cbmltcG9ydCB7IGluZm9Db21tYW5kIH0gZnJvbSBcIi4vaW5mby5qc1wiO1xuaW1wb3J0IHsgc3B5IH0gZnJvbSBcIi4vc3B5XCI7XG5pbXBvcnQgeyBDb21tYW5kIH0gZnJvbSAnY29tbWFuZGVyJztcblxuY29uc3QgVVNFX0VYUEVSSU1FTlRBTF9GRUFUVVJFUyA9IGZhbHNlO1xuXG5hc3luYyBmdW5jdGlvbiBzZXR1cENvbW1hbmQoZGV2OiBEZXYsIG9wdGlvbnM6IFNldHVwT3B0aW9ucykge1xuICAgIGF3YWl0IGRldi5zdGFydChjb21waWxlcnNXaXRoTmV0d29ya3MoZGV2LCBvcHRpb25zKSk7XG59XG5cblxuYXN5bmMgZnVuY3Rpb24gc3RhcnRDb21tYW5kKGRldjogRGV2LCBvcHRpb25zOiBTdGFydE9wdGlvbnMpIHtcbiAgICBhd2FpdCBkZXYuc3RhcnQoY29tcGlsZXJzV2l0aE5ldHdvcmtzKGRldiwgb3B0aW9ucykpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdG9wQ29tbWFuZChkZXY6IERldiwgb3B0aW9uczogU3RvcE9wdGlvbnMpIHtcbiAgICBhd2FpdCBkZXYuc3RvcChjb21waWxlcnNXaXRoTmV0d29ya3MoZGV2LCBvcHRpb25zKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJlc3RhcnRDb21tYW5kKGRldjogRGV2LCBvcHRpb25zOiBSZXN0YXJ0T3B0aW9ucykge1xuICAgIGF3YWl0IGRldi5yZXN0YXJ0KGNvbXBpbGVyc1dpdGhOZXR3b3JrcyhkZXYsIG9wdGlvbnMpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcmVjcmVhdGVDb21tYW5kKGRldjogRGV2LCBvcHRpb25zOiBSZWNyZWF0ZU9wdGlvbnMpIHtcbiAgICBhd2FpdCBkZXYucmVjcmVhdGUoY29tcGlsZXJzV2l0aE5ldHdvcmtzKGRldiwgb3B0aW9ucykpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjbGVhbkNvbW1hbmQoZGV2OiBEZXYsIG9wdGlvbnM6IENsZWFuT3B0aW9ucykge1xuICAgIGNvbnN0IGFsbCA9ICFvcHRpb25zLmNvbXBpbGVycyAmJiAhb3B0aW9ucy5uZXR3b3JrcztcbiAgICBhd2FpdCBkZXYuY2xlYW4oXG4gICAgICAgIG9wdGlvbnMuY29tcGlsZXJzIHx8IGFsbCxcbiAgICAgICAgb3B0aW9ucy5uZXR3b3JrcyB8fCBhbGwsXG4gICAgICAgIG9wdGlvbnMuY29udGFpbmVycyxcbiAgICApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZXRDb21tYW5kKGRldjogRGV2LCBuYW1lczogc3RyaW5nW10sIG9wdGlvbnM6IFNldE5ldHdvcmtPcHRpb25zKSB7XG4gICAgYXdhaXQgZGV2LnVwZGF0ZU5ldHdvcmtDb25maWdzKGRldi5uZXR3b3Jrc09yQWxsKG5hbWVzKSwgKGNvbmZpZzogTmV0d29ya0NvbmZpZykgPT4ge1xuICAgICAgICBpZiAob3B0aW9ucy5uZXdOYW1lKSB7XG4gICAgICAgICAgICBjb25maWcubmFtZSA9IG9wdGlvbnMubmV3TmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5wb3J0KSB7XG4gICAgICAgICAgICBjb25maWcuaG9zdFBvcnQgPSBvcHRpb25zLnBvcnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuZGJQb3J0KSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5kYlBvcnQgPT09ICdiaW5kJykge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5hcmFuZ29Ib3N0UG9ydCA9IE5ldHdvcmsuZGVmYXVsdEFyYW5nb1BvcnQ7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuZGJQb3J0ID09PSAndW5iaW5kJykge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5hcmFuZ29Ib3N0UG9ydCA9ICcnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25maWcuYXJhbmdvSG9zdFBvcnQgPSBvcHRpb25zLmRiUG9ydCB8fCAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBhZGRDb21tYW5kKGRldjogRGV2LCBuYW1lczogc3RyaW5nW10pIHtcbiAgICBhd2FpdCBkZXYuYWRkTmV0d29ya3MobmFtZXMpO1xufVxuXG5hc3luYyBmdW5jdGlvbiByZW1vdmVDb21tYW5kKGRldjogRGV2LCBuYW1lczogc3RyaW5nW10pIHtcbiAgICBhd2FpdCBkZXYucmVtb3ZlTmV0d29ya3MoZGV2Lm5ldHdvcmtzRnJvbU5hbWVzKG5hbWVzKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlS2V5c0NvbW1hbmQoX2RldjogRGV2KSB7XG4gICAgY29uc3QgY2xpZW50ID0gYXdhaXQgVE9OQ2xpZW50LmNyZWF0ZSh7XG4gICAgICAgIHNlcnZlcnM6IFsnaHR0cDovL2xvY2FsaG9zdCddLFxuICAgIH0pO1xuICAgIGNvbnN0IGtleXMgPSBhd2FpdCBjbGllbnQuY3J5cHRvLmVkMjU1MTlLZXlwYWlyKCk7XG4gICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoa2V5cywgdW5kZWZpbmVkLCA0KSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNvbnZlcnRBZGRyZXNzKF9kZXY6IERldiwgYWRkcikge1xuICAgIGNvbnN0IGNsaWVudCA9IGF3YWl0IFRPTkNsaWVudC5jcmVhdGUoe1xuICAgICAgICBzZXJ2ZXJzOiBbJ2h0dHA6Ly9sb2NhbGhvc3QnXSxcbiAgICB9KTtcbiAgICBjb25zdCBzaG93Q29udmVydGVkID0gKHRpdGxlLCBjb252ZXJ0ZWQpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coYCR7Y29udmVydGVkLmFkZHJlc3MgPT09IGFkZHIgPyAn4pyTJyA6ICcgJ30gJHt0aXRsZX0gPSAke2NvbnZlcnRlZC5hZGRyZXNzfWApO1xuICAgIH07XG4gICAgY29uc3Qgc2hvd0hleCA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgY29udmVydGVkID0gYXdhaXQgY2xpZW50LmNvbnRyYWN0cy5jb252ZXJ0QWRkcmVzcyh7XG4gICAgICAgICAgICBhZGRyZXNzOiBhZGRyLFxuICAgICAgICAgICAgY29udmVydFRvOiAnSGV4JyxcbiAgICAgICAgfSk7XG4gICAgICAgIHNob3dDb252ZXJ0ZWQoJ2hleCcsIGNvbnZlcnRlZCk7XG4gICAgfTtcbiAgICBjb25zdCBzaG93QmFzZTY0ID0gYXN5bmMgKHRlc3QsIGJvdW5jZSwgdXJsKSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbnZlcnRlZCA9IGF3YWl0IGNsaWVudC5jb250cmFjdHMuY29udmVydEFkZHJlc3Moe1xuICAgICAgICAgICAgYWRkcmVzczogYWRkcixcbiAgICAgICAgICAgIGNvbnZlcnRUbzogJ0Jhc2U2NCcsXG4gICAgICAgICAgICBiYXNlNjRQYXJhbXM6IHtcbiAgICAgICAgICAgICAgICBib3VuY2UsXG4gICAgICAgICAgICAgICAgdGVzdCxcbiAgICAgICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgZmxhZ3MgPSBbXG4gICAgICAgICAgICB0ZXN0ID8gJ3Rlc3QnIDogJ21haW4nLFxuICAgICAgICAgICAgYm91bmNlID8gJ2JvdW5jZScgOiAnJyxcbiAgICAgICAgICAgIHVybCA/ICd1cmwnIDogJycsXG4gICAgICAgIF1cbiAgICAgICAgICAgIC5maWx0ZXIoeCA9PiB4ICE9PSAnJylcbiAgICAgICAgICAgIC5qb2luKCcgJyk7XG4gICAgICAgIHNob3dDb252ZXJ0ZWQoZmxhZ3MsIGNvbnZlcnRlZCk7XG4gICAgfTtcbiAgICBhd2FpdCBzaG93SGV4KCk7XG4gICAgYXdhaXQgc2hvd0Jhc2U2NChmYWxzZSwgZmFsc2UsIGZhbHNlKTtcbiAgICBhd2FpdCBzaG93QmFzZTY0KGZhbHNlLCBmYWxzZSwgdHJ1ZSk7XG4gICAgYXdhaXQgc2hvd0Jhc2U2NChmYWxzZSwgdHJ1ZSwgZmFsc2UpO1xuICAgIGF3YWl0IHNob3dCYXNlNjQoZmFsc2UsIHRydWUsIHRydWUpO1xuICAgIGF3YWl0IHNob3dCYXNlNjQodHJ1ZSwgZmFsc2UsIGZhbHNlKTtcbiAgICBhd2FpdCBzaG93QmFzZTY0KHRydWUsIGZhbHNlLCB0cnVlKTtcbiAgICBhd2FpdCBzaG93QmFzZTY0KHRydWUsIHRydWUsIGZhbHNlKTtcbiAgICBhd2FpdCBzaG93QmFzZTY0KHRydWUsIHRydWUsIHRydWUpO1xufVxuXG5hc3luYyBmdW5jdGlvbiB1c2VDb21tYW5kKGRldjogRGV2LCB2ZXJzaW9uOiBzdHJpbmcsIG9wdGlvbnM6IFVzZU9wdGlvbnMpIHtcbiAgICBhd2FpdCBkZXYudXNlVmVyc2lvbih2ZXJzaW9uLCBjb21waWxlcnNXaXRoTmV0d29ya3MoZGV2LCBvcHRpb25zKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNvbENvbW1hbmQoZGV2OiBEZXYsIGZpbGVzOiBzdHJpbmdbXSwgb3B0aW9uczogU29sT3B0aW9ucykge1xuICAgIGlmIChmaWxlcy5sZW5ndGggPCAxKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IG11c3Qgc3BlY2lmeSBhdCBsZWFzdCBvbmUgZmlsZSBuYW1lJyk7XG4gICAgfVxuICAgIGF3YWl0IFNvbGlkaXR5LmJ1aWxkKGRldiwgZmlsZXMsIHtcbiAgICAgICAgY2xpZW50TGFuZ3VhZ2VzOiAob3B0aW9ucy5jbGllbnRMYW5ndWFnZXMgfHwgJycpLnNwbGl0KCcsJykuZmlsdGVyKHggPT4geCksXG4gICAgICAgIGNsaWVudExldmVsOiBvcHRpb25zLmNsaWVudExldmVsIHx8IENsaWVudENvZGVMZXZlbC5ydW4sXG4gICAgICAgIGpzTW9kdWxlOiBvcHRpb25zLmpzTW9kdWxlIHx8IEpTTW9kdWxlLm5vZGUsXG4gICAgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdlbkNvbW1hbmQoZGV2OiBEZXYsIGZpbGVzOiBzdHJpbmdbXSwgb3B0aW9uczogU29sT3B0aW9ucykge1xuICAgIGlmIChmaWxlcy5sZW5ndGggPCAxKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IG11c3Qgc3BlY2lmeSBhdCBsZWFzdCBvbmUgZmlsZSBuYW1lJyk7XG4gICAgfVxuICAgIGF3YWl0IENsaWVudENvZGUuZ2VuZXJhdGUoZmlsZXMsIHtcbiAgICAgICAgY2xpZW50TGFuZ3VhZ2VzOiAob3B0aW9ucy5jbGllbnRMYW5ndWFnZXMgfHwgJycpLnNwbGl0KCcsJyksXG4gICAgICAgIGNsaWVudExldmVsOiBvcHRpb25zLmNsaWVudExldmVsIHx8IENsaWVudENvZGVMZXZlbC5ydW4sXG4gICAgICAgIGpzTW9kdWxlOiBvcHRpb25zLmpzTW9kdWxlIHx8IEpTTW9kdWxlLm5vZGUsXG4gICAgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNweUNvbW1hbmQoZGV2OiBEZXYsIG5ldHdvcmtzOiBzdHJpbmdbXSkge1xuICAgIGF3YWl0IHNweShkZXYsIG5ldHdvcmtzKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gd2ViQ29uc29sZUNvbW1hbmQoZGV2OiBEZXYsIG9wdGlvbnM6IFdlYk9wdGlvbnMpIHtcbiAgICBhd2FpdCB3ZWIoZGV2LCBvcHRpb25zKTtcbn1cblxuY29uc3QgbmV0d29ya3NPcHRpb24gPSBbXG4gICAgJy1uLCAtLW5ldHdvcmtzIFtuYW1lc10nLFxuICAgICdBcHBseSBjb21tYW5kIHRvIHNwZWNpZmllZCBuZXR3b3JrW3NdIChuYW1lcyBtdXN0IGJlIHNlcGFyYXRlZCB3aXRoIGNvbW1hKS4nXG5dO1xuXG5jb25zdCBjb21waWxlcnNPcHRpb24gPSBbXG4gICAgJy1tLCAtLWNvbXBpbGVycycsXG4gICAgJ0FwcGx5IGNvbW1hbmQgdG8gdGhlIGNvbXBpbGVycyBjb250YWluZXIuJ1xuXTtcblxuZnVuY3Rpb24gZ2V0U3VwcG9ydGVkTGFuZ3VhZ2VzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhDbGllbnRDb2RlLmxhbmd1YWdlcykubWFwKCh4OiBhbnkpID0+IHguc2hvcnROYW1lKTtcbn1cblxuY29uc3QgY2xpZW50TGFuZ3VhZ2VzT3B0aW9uID0gW1xuICAgICctbCwgLS1jbGllbnQtbGFuZ3VhZ2VzIDxsYW5ndWFnZXM+JyxcbiAgICBgR2VuZXJhdGUgY2xpZW50IGNvZGUgZm9yIHNwZWNpZmllZCBsYW5ndWFnZXMgc2VwYXJhdGVkIGJ5IGNvbW1hLCBgICtcbiAgICBgc3VwcG9ydGVkIGxhbmd1YWdlczogXCIke2dldFN1cHBvcnRlZExhbmd1YWdlcygpLmpvaW4oJ1wiLCBcIicpfVwiLmAsXG5dO1xuXG5jb25zdCBjbGllbnRMZXZlbE9wdGlvbiA9IFtcbiAgICAnLUwsIC0tY2xpZW50LWxldmVsIDxjbGllbnQtbGV2ZWw+JyxcbiAgICAnQ2xpZW50IGNvZGUgbGV2ZWw6ICcgK1xuICAgICdcInJ1blwiIHRvIHJ1biBvbmx5LCAnICtcbiAgICAnXCJkZXBsb3lcIiB0byBydW4gYW5kIGRlcGxveSAoaW5jbHVkZXMgYW4gaW1hZ2VCYXNlNjQgb2YgYmluYXJ5IGNvbnRyYWN0KScsXG4gICAgJ2RlcGxveSdcbl07XG5cbmNvbnN0IGpzTW9kdWxlVHlwZU9wdGlvbiA9IFtcbiAgICAnLS1qcy1tb2R1bGUgPG1vZHVsZS10eXBlPicsXG4gICAgXCJKYXZhIFNjcmlwdCBtb2R1bGUgdHlwZTogXCIgK1xuICAgIFwiYG5vZGVgIHRvIHVzZSB3aXRoIGBjb25zdCBGb29Db250cmFjdCA9IHJlcXVpcmUoJ2ZvbycpYCwgXCIgK1xuICAgIFwiYG5vZGVOb0RlZmF1bHRgIHRvIHVzZSB3aXRoIGBjb25zdCB7Rm9vQ29udHJhY3R9ID0gcmVxdWlyZSgnZm9vJylgLCBcIiArXG4gICAgXCJgZXNgIHRvIHVzZSB3aXRoIGBpbXBvcnQgRm9vQ29udHJhY3QgZnJvbSAnZm9vJ2AsIFwiICtcbiAgICBcImBlc05vRGVmYXVsdGAgdG8gdXNlIHdpdGggYGltcG9ydCB7Rm9vQ29udHJhY3R9IGZyb20gJ2ZvbydgLlwiLFxuICAgICdub2RlJ1xuXTtcblxuXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVDb21tYW5kTGluZShkZXY6IERldiwgYXJnczogc3RyaW5nW10pIHtcbiAgICBjb25zdCBwcm9ncmFtID0gbmV3IENvbW1hbmQoKTtcblxuICAgIGxldCBjb21tYW5kQWN0aW9uID0gaW5mb0NvbW1hbmQ7XG4gICAgbGV0IGNvbW1hbmRBcmdzID0gW107XG5cbiAgICBjb25zdCBjb21tYW5kID0gKGFjdGlvbikgPT4ge1xuICAgICAgICByZXR1cm4gKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgICAgIGNvbW1hbmRBY3Rpb24gPSBhY3Rpb247XG4gICAgICAgICAgICBjb21tYW5kQXJncyA9IGFyZ3M7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIHByb2dyYW1cbiAgICAgICAgLm5hbWUoZGV2Lm5hbWUpXG4gICAgICAgIC52ZXJzaW9uKGRldi52ZXJzaW9uKVxuICAgICAgICAub3B0aW9uKCctYSwgLS1hdmFpbGFibGUnLCAnU2hvdyBhdmFpbGFibGUgdmVyc2lvbnMuJylcbiAgICAgICAgLmRlc2NyaXB0aW9uKCdUT04gTGFicyBkZXZlbG9wbWVudCB0b29scycpO1xuXG4gICAgcHJvZ3JhbVxuICAgICAgICAuY29tbWFuZCgnaW5mbycsIHsgaXNEZWZhdWx0OiB0cnVlIH0pLmRlc2NyaXB0aW9uKCdTaG93IHN1bW1hcnkgYWJvdXQgZGV2IGVudmlyb25tZW50LicpXG4gICAgICAgIC5vcHRpb24oJy1hLCAtLWF2YWlsYWJsZScsICdTaG93IGF2YWlsYWJsZSB2ZXJzaW9ucy4nKVxuICAgICAgICAuYWN0aW9uKGNvbW1hbmQoaW5mb0NvbW1hbmQpKTtcblxuICAgIHByb2dyYW1cbiAgICAgICAgLmNvbW1hbmQoJ3NvbCBbZmlsZXMuLi5dJykuZGVzY3JpcHRpb24oJ0J1aWxkIHNvbGlkaXR5IGNvbnRyYWN0W3NdLicpXG4gICAgICAgIC5vcHRpb24oLi4uY2xpZW50TGFuZ3VhZ2VzT3B0aW9uKVxuICAgICAgICAub3B0aW9uKC4uLmNsaWVudExldmVsT3B0aW9uKVxuICAgICAgICAub3B0aW9uKC4uLmpzTW9kdWxlVHlwZU9wdGlvbilcbiAgICAgICAgLmFjdGlvbihjb21tYW5kKHNvbENvbW1hbmQpKTtcblxuICAgIHByb2dyYW1cbiAgICAgICAgLmNvbW1hbmQoJ2dlbiBbZmlsZXMuLi5dJykuZGVzY3JpcHRpb24oJ0dlbmVyYXRlIGNsaWVudCBjb2RlIGZvciBjb250cmFjdFtzXS4nKVxuICAgICAgICAub3B0aW9uKGNsaWVudExhbmd1YWdlc09wdGlvblswXSwgY2xpZW50TGFuZ3VhZ2VzT3B0aW9uWzFdLCAnanMnKVxuICAgICAgICAub3B0aW9uKC4uLmNsaWVudExldmVsT3B0aW9uKVxuICAgICAgICAub3B0aW9uKC4uLmpzTW9kdWxlVHlwZU9wdGlvbilcbiAgICAgICAgLmFjdGlvbihjb21tYW5kKGdlbkNvbW1hbmQpKTtcblxuICAgIHByb2dyYW1cbiAgICAgICAgLmNvbW1hbmQoJ3N0YXJ0JykuZGVzY3JpcHRpb24oJ1N0YXJ0IGRldiBjb250YWluZXJzLicpXG4gICAgICAgIC5vcHRpb24oLi4ubmV0d29ya3NPcHRpb24pXG4gICAgICAgIC5vcHRpb24oLi4uY29tcGlsZXJzT3B0aW9uKVxuICAgICAgICAuYWN0aW9uKGNvbW1hbmQoc3RhcnRDb21tYW5kKSk7XG5cbiAgICBwcm9ncmFtXG4gICAgICAgIC5jb21tYW5kKCdzdG9wJykuZGVzY3JpcHRpb24oJ1N0b3AgZGV2IGNvbnRhaW5lcnMuJylcbiAgICAgICAgLm9wdGlvbiguLi5uZXR3b3Jrc09wdGlvbilcbiAgICAgICAgLm9wdGlvbiguLi5jb21waWxlcnNPcHRpb24pXG4gICAgICAgIC5hY3Rpb24oY29tbWFuZChzdG9wQ29tbWFuZCkpO1xuXG4gICAgcHJvZ3JhbVxuICAgICAgICAuY29tbWFuZCgncmVzdGFydCcpLmRlc2NyaXB0aW9uKCdSZXN0YXJ0IGRldiBjb250YWluZXJzLicpXG4gICAgICAgIC5vcHRpb24oLi4ubmV0d29ya3NPcHRpb24pXG4gICAgICAgIC5vcHRpb24oLi4uY29tcGlsZXJzT3B0aW9uKVxuICAgICAgICAuYWN0aW9uKGNvbW1hbmQocmVzdGFydENvbW1hbmQpKTtcblxuICAgIHByb2dyYW1cbiAgICAgICAgLmNvbW1hbmQoJ3JlY3JlYXRlJykuZGVzY3JpcHRpb24oJ1JlY3JlYXRlIGRldiBjb250YWluZXJzLicpXG4gICAgICAgIC5vcHRpb24oLi4ubmV0d29ya3NPcHRpb24pXG4gICAgICAgIC5vcHRpb24oLi4uY29tcGlsZXJzT3B0aW9uKVxuICAgICAgICAuYWN0aW9uKGNvbW1hbmQocmVjcmVhdGVDb21tYW5kKSk7XG5cbiAgICBwcm9ncmFtXG4gICAgICAgIC5jb21tYW5kKCdzZXR1cCcpLmRlc2NyaXB0aW9uKCdTZXR1cCBkZXYgZW52aXJvbm1lbnQuJylcbiAgICAgICAgLm9wdGlvbiguLi5uZXR3b3Jrc09wdGlvbilcbiAgICAgICAgLm9wdGlvbiguLi5jb21waWxlcnNPcHRpb24pXG4gICAgICAgIC5hY3Rpb24oY29tbWFuZChzZXR1cENvbW1hbmQpKTtcblxuICAgIHByb2dyYW1cbiAgICAgICAgLmNvbW1hbmQoJ2NsZWFuJykuZGVzY3JpcHRpb24oJ1JlbW92ZSBkb2NrZXIgY29udGFpbmVycyBhbmQgaW1hZ2VzIHJlbGF0ZWQgdG8gVE9OIERldi4nKVxuICAgICAgICAub3B0aW9uKCctbiwgLS1uZXR3b3JrcycsICdDbGVhbiBsb2NhbCBub2RlIGRvY2tlciBjb250YWluZXJzIGFuZCBpbWFnZXMuJylcbiAgICAgICAgLm9wdGlvbignLW0sIC0tY29tcGlsZXJzJywgJ0NsZWFuIGNvbXBpbGVycyBkb2NrZXIgY29udGFpbmVycyBhbmQgaW1hZ2VzLicpXG4gICAgICAgIC5vcHRpb24oJy1jLCAtLWNvbnRhaW5lcnMnLCAnQ2xlYW4gY29udGFpbmVycyBvbmx5LicsIGZhbHNlKVxuICAgICAgICAuYWN0aW9uKGNvbW1hbmQoY2xlYW5Db21tYW5kKSk7XG5cbiAgICBwcm9ncmFtXG4gICAgICAgIC5jb21tYW5kKCd1c2UgPHZlcnNpb24+JykuZGVzY3JpcHRpb24oJ1VzZSBzcGVjaWZpZWQgdmVyc2lvbiBmb3IgY29udGFpbmVycy4nKVxuICAgICAgICAub3B0aW9uKC4uLm5ldHdvcmtzT3B0aW9uKVxuICAgICAgICAub3B0aW9uKC4uLmNvbXBpbGVyc09wdGlvbilcbiAgICAgICAgLmFjdGlvbihjb21tYW5kKHVzZUNvbW1hbmQpKTtcblxuICAgIHByb2dyYW1cbiAgICAgICAgLmNvbW1hbmQoJ3NldCBbbmV0d29yay4uLl0nKS5kZXNjcmlwdGlvbignU2V0IG5ldHdvcmtbc10gb3B0aW9ucy4nKVxuICAgICAgICAub3B0aW9uKCctcCwgLS1wb3J0IDxwb3J0PicsICdIb3N0IHBvcnQgdG8gYm91bmQgbG9jYWwgbm9kZS4nKVxuICAgICAgICAub3B0aW9uKFxuICAgICAgICAgICAgJy1kLCAtLWRiLXBvcnQgPGJpbmRpbmc+JyxcbiAgICAgICAgICAgICdIb3N0IHBvcnQgdG8gYm91bmQgbG9jYWwgbm9kZXMgQXJhbmdvIERCIChcImJpbmRcIiB0byB1c2UgZGVmYXVsdCBBcmFuZ28gREIgcG9ydCwgXCJ1bmJpbmRcIiB0byB1bmJpbmQgQXJhbmdvIERCIHBvcnQpLicsXG4gICAgICAgIClcbiAgICAgICAgLm9wdGlvbignLW4sIC0tbmV3LW5hbWUgPG5hbWU+JywgJ1NldCBuZXcgbmFtZSBmb3IgbmV0d29yay4nKVxuICAgICAgICAuYWN0aW9uKGNvbW1hbmQoc2V0Q29tbWFuZCkpO1xuXG4gICAgcHJvZ3JhbVxuICAgICAgICAuY29tbWFuZCgnYWRkIFtuZXR3b3JrLi4uXScpLmRlc2NyaXB0aW9uKCdBZGQgbmV0d29ya1tzXS4nKVxuICAgICAgICAuYWN0aW9uKGNvbW1hbmQoYWRkQ29tbWFuZCkpO1xuXG4gICAgcHJvZ3JhbVxuICAgICAgICAuY29tbWFuZCgncmVtb3ZlIFtuZXR3b3JrLi4uXScpLmFsaWFzKCdybScpLmRlc2NyaXB0aW9uKCdSZW1vdmUgbmV0d29ya1tzXS4nKVxuICAgICAgICAuYWN0aW9uKGNvbW1hbmQocmVtb3ZlQ29tbWFuZCkpO1xuXG4gICAgcHJvZ3JhbVxuICAgICAgICAuY29tbWFuZCgna2V5cycpLmFsaWFzKCdrJykuZGVzY3JpcHRpb24oJ0dlbmVyYXRlIHJhbmRvbSBLZXkgUGFpci4nKVxuICAgICAgICAuYWN0aW9uKGNvbW1hbmQoZ2VuZXJhdGVLZXlzQ29tbWFuZCkpO1xuXG4gICAgcHJvZ3JhbVxuICAgICAgICAuY29tbWFuZCgnYWRkciA8YWRkcj4nKS5hbGlhcygnYScpLmRlc2NyaXB0aW9uKCdDb252ZXJ0IGFkZHJlc3MuJylcbiAgICAgICAgLmFjdGlvbihjb21tYW5kKGNvbnZlcnRBZGRyZXNzKSlcbiAgICAgICAgLmFsbG93VW5rbm93bk9wdGlvbih0cnVlKTtcblxuICAgIGlmIChVU0VfRVhQRVJJTUVOVEFMX0ZFQVRVUkVTKSB7XG4gICAgICAgIHByb2dyYW1cbiAgICAgICAgICAgIC5jb21tYW5kKCdzcHkgW25ldHdvcmtzLi4uXScpLmRlc2NyaXB0aW9uKCdSdW4gbmV0d29yayBzY2FubmVyLicpXG4gICAgICAgICAgICAuYWN0aW9uKGNvbW1hbmQoc3B5Q29tbWFuZCkpO1xuXG4gICAgICAgIHByb2dyYW1cbiAgICAgICAgICAgIC5jb21tYW5kKCd3ZWInKS5kZXNjcmlwdGlvbignUnVuIHdlYiBjb25zb2xlLicpXG4gICAgICAgICAgICAub3B0aW9uKCctcCwgLS1wb3J0IDxwb3J0PicsICdIb3N0IHBvcnQgdG8gYm91bmQgd2ViIGNvbnNvbGUuJywgJzg4MDAnKVxuICAgICAgICAgICAgLmFjdGlvbihjb21tYW5kKHdlYkNvbnNvbGVDb21tYW5kKSk7XG5cblxuICAgIH1cblxuICAgIHByb2dyYW0ucGFyc2UoYXJncyk7XG5cbiAgICBpZiAoY29tbWFuZEFyZ3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGlmIChwcm9ncmFtLmFyZ3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBhd2FpdCBpbmZvQ29tbWFuZChkZXYsIHByb2dyYW0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcHJvZ3JhbS5vdXRwdXRIZWxwKCk7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoY29tbWFuZEFjdGlvbiA9PT0gaW5mb0NvbW1hbmQpIHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBjb21tYW5kQXJnc1tjb21tYW5kQXJncy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIG9wdGlvbnMuYXZhaWxhYmxlID0gb3B0aW9ucy5wYXJlbnQuYXZhaWxhYmxlO1xuICAgICAgICB9XG4gICAgICAgIGF3YWl0IGNvbW1hbmRBY3Rpb24oZGV2LCAuLi5jb21tYW5kQXJncyk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBoYW5kbGVDb21tYW5kTGluZSB9O1xuIl19