"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.handleCommandLine = handleCommandLine;

var _tonClientNodeJs = require("ton-client-node-js");

var _clientCode = require("../compilers/client-code");

var _solidity = require("../compilers/solidity");

var _dev2 = require("../dev");

var _networks = require("../networks/networks");

var _server = require("../server/server");

var _options = require("./options");

var _info = require("./info.js");

var _spy = require("./spy");

/*
 * Copyright 2018-2020 TON DEV SOLUTIONS LTD.
 *
 * Licensed under the SOFTWARE EVALUATION License (the "License"); you may not use
 * this file except in compliance with the License.  You may obtain a copy of the
 * License at: https://www.ton.dev/licenses
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific TON DEV software governing permissions and
 * limitations under the License.
 *
 */
const USE_EXPERIMENTAL_FEATURES = false;

const program = require('commander');

async function setupCommand(dev, options) {
  await dev.start((0, _options.compilersWithNetworks)(dev, options));
}

async function startCommand(dev, options) {
  await dev.start((0, _options.compilersWithNetworks)(dev, options));
}

async function stopCommand(dev, options) {
  await dev.stop((0, _options.compilersWithNetworks)(dev, options));
}

async function restartCommand(dev, options) {
  await dev.restart((0, _options.compilersWithNetworks)(dev, options));
}

async function recreateCommand(dev, options) {
  await dev.recreate((0, _options.compilersWithNetworks)(dev, options));
}

async function cleanCommand(dev, options) {
  const all = !options.compilers && !options.networks;
  await dev.clean(options.compilers || all, options.networks || all, options.containers);
}

async function setCommand(dev, names, options) {
  await dev.updateNetworkConfigs(dev.networksOrAll(names), config => {
    if (options.newName) {
      config.name = options.newName;
    }

    if (options.port) {
      config.hostPort = options.port;
    }

    if (options.dbPort) {
      if (options.dbPort === 'bind') {
        config.arangoHostPort = _networks.Network.defaultArangoPort;
      } else if (options.dbPort === 'unbind') {
        config.arangoHostPort = '';
      } else {
        config.arangoHostPort = options.dbPort || '';
      }
    }
  });
}

async function addCommand(dev, names) {
  await dev.addNetworks(names);
}

async function removeCommand(dev, names) {
  await dev.removeNetworks(dev.networksFromNames(names));
}

async function generateKeysCommand(_dev) {
  const client = await _tonClientNodeJs.TONClient.create({
    servers: ['http://localhost']
  });
  const keys = await client.crypto.ed25519Keypair();
  console.log(JSON.stringify(keys, undefined, 4));
}

async function convertAddress(_dev, addr) {
  const client = await _tonClientNodeJs.TONClient.create({
    servers: ['http://localhost']
  });

  const showConverted = (title, converted) => {
    console.log(`${converted.address === addr ? 'âœ“' : ' '} ${title} = ${converted.address}`);
  };

  const showHex = async () => {
    const converted = await client.contracts.convertAddress({
      address: addr,
      convertTo: 'Hex'
    });
    showConverted('hex', converted);
  };

  const showBase64 = async (test, bounce, url) => {
    const converted = await client.contracts.convertAddress({
      address: addr,
      convertTo: 'Base64',
      base64Params: {
        bounce,
        test,
        url
      }
    });
    const flags = [test ? 'test' : 'main', bounce ? 'bounce' : '', url ? 'url' : ''].filter(x => x !== '').join(' ');
    showConverted(flags, converted);
  };

  await showHex();
  await showBase64(false, false, false);
  await showBase64(false, false, true);
  await showBase64(false, true, false);
  await showBase64(false, true, true);
  await showBase64(true, false, false);
  await showBase64(true, false, true);
  await showBase64(true, true, false);
  await showBase64(true, true, true);
}

async function useCommand(dev, version, options) {
  await dev.useVersion(version, (0, _options.compilersWithNetworks)(dev, options));
}

async function solCommand(dev, files, options) {
  if (files.length < 1) {
    throw new Error('You must specify at least one file name');
  }

  await _solidity.Solidity.build(dev, files, {
    clientLanguages: (options.clientLanguages || '').split(',').filter(x => x),
    clientLevel: options.clientLevel || _clientCode.ClientCodeLevel.run,
    jsModule: options.jsModule || _clientCode.JSModule.node
  });
}

async function genCommand(dev, files, options) {
  if (files.length < 1) {
    throw new Error('You must specify at least one file name');
  }

  await _clientCode.ClientCode.generate(files, {
    clientLanguages: (options.clientLanguages || '').split(','),
    clientLevel: options.clientLevel || _clientCode.ClientCodeLevel.run,
    jsModule: options.jsModule || _clientCode.JSModule.node
  });
}

async function spyCommand(dev, networks) {
  await (0, _spy.spy)(dev, networks);
}

async function webConsoleCommand(dev, options) {
  await (0, _server.web)(dev, options);
}

const networksOption = ['-n, --networks [names]', 'Apply command to specified network[s] (names must be separated with comma).'];
const compilersOption = ['-m, --compilers', 'Apply command to the compilers container.'];

function getSupportedLanguages() {
  return Object.values(_clientCode.ClientCode.languages).map(x => x.shortName);
}

const clientLanguagesOption = ['-l, --client-languages <languages>', `Generate client code for specified languages separated by comma, ` + `supported languages: "${getSupportedLanguages().join('", "')}".`];
const clientLevelOption = ['-L, --client-level <client-level>', 'Client code level: ' + '"run" to run only, ' + '"deploy" to run and deploy (includes an imageBase64 of binary contract)', 'deploy'];
const jsModuleTypeOption = ['--js-module <module-type>', "Java Script module type: " + "`node` to use with `const FooContract = require('foo')`, " + "`nodeNoDefault` to use with `const {FooContract} = require('foo')`, " + "`es` to use with `import FooContract from 'foo'`, " + "`esNoDefault` to use with `import {FooContract} from 'foo'`.", 'node'];

async function handleCommandLine(dev, args) {
  let commandAction = _info.infoCommand;
  let commandArgs = [];

  const command = action => {
    return (...args) => {
      commandAction = action;
      commandArgs = args;
    };
  };

  program.name(dev.name).version(dev.version).option('-a, --available', 'Show available versions.').description('TON Labs development tools');
  program.command('info', {
    isDefault: true
  }).description('Show summary about dev environment.').option('-a, --available', 'Show available versions.').action(command(_info.infoCommand));
  program.command('sol [files...]').description('Build solidity contract[s].').option(...clientLanguagesOption).option(...clientLevelOption).option(...jsModuleTypeOption).action(command(solCommand));
  program.command('gen [files...]').description('Generate client code for contract[s].').option(clientLanguagesOption[0], clientLanguagesOption[1], 'js').option(...clientLevelOption).option(...jsModuleTypeOption).action(command(genCommand));
  program.command('start').description('Start dev containers.').option(...networksOption).option(...compilersOption).action(command(startCommand));
  program.command('stop').description('Stop dev containers.').option(...networksOption).option(...compilersOption).action(command(stopCommand));
  program.command('restart').description('Restart dev containers.').option(...networksOption).option(...compilersOption).action(command(restartCommand));
  program.command('recreate').description('Recreate dev containers.').option(...networksOption).option(...compilersOption).action(command(recreateCommand));
  program.command('setup').description('Setup dev environment.').option(...networksOption).option(...compilersOption).action(command(setupCommand));
  program.command('clean').description('Remove docker containers and images related to TON Dev.').option('-n, --networks', 'Clean local node docker containers and images.').option('-m, --compilers', 'Clean compilers docker containers and images.').option('-c, --containers', 'Clean containers only.', false).action(command(cleanCommand));
  program.command('use <version>').description('Use specified version for containers.').option(...networksOption).option(...compilersOption).action(command(useCommand));
  program.command('set [network...]').description('Set network[s] options.').option('-p, --port <port>', 'Host port to bound local node.').option('-d, --db-port <binding>', 'Host port to bound local nodes Arango DB ("bind" to use default Arango DB port, "unbind" to unbind Arango DB port).').option('-n, --new-name <name>', 'Set new name for network.').action(command(setCommand));
  program.command('add [network...]').description('Add network[s].').action(command(addCommand));
  program.command('remove [network...]').alias('rm').description('Remove network[s].').action(command(removeCommand));
  program.command('keys').alias('k').description('Generate random Key Pair.').action(command(generateKeysCommand));
  program.command('addr <addr>').alias('a').description('Convert address.').action(command(convertAddress)).allowUnknownOption(true);

  if (USE_EXPERIMENTAL_FEATURES) {
    program.command('spy [networks...]').description('Run network scanner.').action(command(spyCommand));
    program.command('web').description('Run web console.').option('-p, --port <port>', 'Host port to bound web console.', '8800').action(command(webConsoleCommand));
  }

  program.parse(args);

  if (commandArgs.length === 0) {
    if (program.args.length === 0) {
      await (0, _info.infoCommand)(dev, program);
    } else {
      program.outputHelp();
    }
  } else {
    if (commandAction === _info.infoCommand) {
      const options = commandArgs[commandArgs.length - 1];
      options.available = options.parent.available;
    }

    await commandAction(dev, ...commandArgs);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jbGkvY2xpLmpzIl0sIm5hbWVzIjpbIlVTRV9FWFBFUklNRU5UQUxfRkVBVFVSRVMiLCJwcm9ncmFtIiwicmVxdWlyZSIsInNldHVwQ29tbWFuZCIsImRldiIsIm9wdGlvbnMiLCJzdGFydCIsInN0YXJ0Q29tbWFuZCIsInN0b3BDb21tYW5kIiwic3RvcCIsInJlc3RhcnRDb21tYW5kIiwicmVzdGFydCIsInJlY3JlYXRlQ29tbWFuZCIsInJlY3JlYXRlIiwiY2xlYW5Db21tYW5kIiwiYWxsIiwiY29tcGlsZXJzIiwibmV0d29ya3MiLCJjbGVhbiIsImNvbnRhaW5lcnMiLCJzZXRDb21tYW5kIiwibmFtZXMiLCJ1cGRhdGVOZXR3b3JrQ29uZmlncyIsIm5ldHdvcmtzT3JBbGwiLCJjb25maWciLCJuZXdOYW1lIiwibmFtZSIsInBvcnQiLCJob3N0UG9ydCIsImRiUG9ydCIsImFyYW5nb0hvc3RQb3J0IiwiTmV0d29yayIsImRlZmF1bHRBcmFuZ29Qb3J0IiwiYWRkQ29tbWFuZCIsImFkZE5ldHdvcmtzIiwicmVtb3ZlQ29tbWFuZCIsInJlbW92ZU5ldHdvcmtzIiwibmV0d29ya3NGcm9tTmFtZXMiLCJnZW5lcmF0ZUtleXNDb21tYW5kIiwiX2RldiIsImNsaWVudCIsIlRPTkNsaWVudCIsImNyZWF0ZSIsInNlcnZlcnMiLCJrZXlzIiwiY3J5cHRvIiwiZWQyNTUxOUtleXBhaXIiLCJjb25zb2xlIiwibG9nIiwiSlNPTiIsInN0cmluZ2lmeSIsInVuZGVmaW5lZCIsImNvbnZlcnRBZGRyZXNzIiwiYWRkciIsInNob3dDb252ZXJ0ZWQiLCJ0aXRsZSIsImNvbnZlcnRlZCIsImFkZHJlc3MiLCJzaG93SGV4IiwiY29udHJhY3RzIiwiY29udmVydFRvIiwic2hvd0Jhc2U2NCIsInRlc3QiLCJib3VuY2UiLCJ1cmwiLCJiYXNlNjRQYXJhbXMiLCJmbGFncyIsImZpbHRlciIsIngiLCJqb2luIiwidXNlQ29tbWFuZCIsInZlcnNpb24iLCJ1c2VWZXJzaW9uIiwic29sQ29tbWFuZCIsImZpbGVzIiwibGVuZ3RoIiwiRXJyb3IiLCJTb2xpZGl0eSIsImJ1aWxkIiwiY2xpZW50TGFuZ3VhZ2VzIiwic3BsaXQiLCJjbGllbnRMZXZlbCIsIkNsaWVudENvZGVMZXZlbCIsInJ1biIsImpzTW9kdWxlIiwiSlNNb2R1bGUiLCJub2RlIiwiZ2VuQ29tbWFuZCIsIkNsaWVudENvZGUiLCJnZW5lcmF0ZSIsInNweUNvbW1hbmQiLCJ3ZWJDb25zb2xlQ29tbWFuZCIsIm5ldHdvcmtzT3B0aW9uIiwiY29tcGlsZXJzT3B0aW9uIiwiZ2V0U3VwcG9ydGVkTGFuZ3VhZ2VzIiwiT2JqZWN0IiwidmFsdWVzIiwibGFuZ3VhZ2VzIiwibWFwIiwic2hvcnROYW1lIiwiY2xpZW50TGFuZ3VhZ2VzT3B0aW9uIiwiY2xpZW50TGV2ZWxPcHRpb24iLCJqc01vZHVsZVR5cGVPcHRpb24iLCJoYW5kbGVDb21tYW5kTGluZSIsImFyZ3MiLCJjb21tYW5kQWN0aW9uIiwiaW5mb0NvbW1hbmQiLCJjb21tYW5kQXJncyIsImNvbW1hbmQiLCJhY3Rpb24iLCJvcHRpb24iLCJkZXNjcmlwdGlvbiIsImlzRGVmYXVsdCIsImFsaWFzIiwiYWxsb3dVbmtub3duT3B0aW9uIiwicGFyc2UiLCJvdXRwdXRIZWxwIiwiYXZhaWxhYmxlIiwicGFyZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBZ0JBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQVdBOztBQUNBOztBQW5DQTs7Ozs7Ozs7Ozs7Ozs7QUFxQ0EsTUFBTUEseUJBQXlCLEdBQUcsS0FBbEM7O0FBRUEsTUFBTUMsT0FBTyxHQUFHQyxPQUFPLENBQUMsV0FBRCxDQUF2Qjs7QUFHQSxlQUFlQyxZQUFmLENBQTRCQyxHQUE1QixFQUFzQ0MsT0FBdEMsRUFBNkQ7QUFDekQsUUFBTUQsR0FBRyxDQUFDRSxLQUFKLENBQVUsb0NBQXNCRixHQUF0QixFQUEyQkMsT0FBM0IsQ0FBVixDQUFOO0FBQ0g7O0FBR0QsZUFBZUUs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SDtBQUNKIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDE4LTIwMjAgVE9OIERFViBTT0xVVElPTlMgTFRELlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBTT0ZUV0FSRSBFVkFMVUFUSU9OIExpY2Vuc2UgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZVxuICogdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlXG4gKiBMaWNlbnNlIGF0OiBodHRwczovL3d3dy50b24uZGV2L2xpY2Vuc2VzXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBUT04gREVWIHNvZnR3YXJlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICpcbiAqL1xuLy8gQGZsb3dcblxuaW1wb3J0IHsgVE9OQ2xpZW50IH0gZnJvbSBcInRvbi1jbGllbnQtbm9kZS1qc1wiO1xuaW1wb3J0IHsgQ2xpZW50Q29kZSwgQ2xpZW50Q29kZUxldmVsLCBKU01vZHVsZSB9IGZyb20gXCIuLi9jb21waWxlcnMvY2xpZW50LWNvZGVcIjtcbmltcG9ydCB7IFNvbGlkaXR5IH0gZnJvbSBcIi4uL2NvbXBpbGVycy9zb2xpZGl0eVwiO1xuaW1wb3J0IHsgRGV2IH0gZnJvbSBcIi4uL2RldlwiO1xuaW1wb3J0IHsgTmV0d29yayB9IGZyb20gXCIuLi9uZXR3b3Jrcy9uZXR3b3Jrc1wiO1xuaW1wb3J0IHR5cGUgeyBOZXR3b3JrQ29uZmlnIH0gZnJvbSBcIi4uL25ldHdvcmtzL25ldHdvcmtzXCI7XG5pbXBvcnQgeyB3ZWIgfSBmcm9tIFwiLi4vc2VydmVyL3NlcnZlclwiO1xuaW1wb3J0IHsgY29tcGlsZXJzV2l0aE5ldHdvcmtzIH0gZnJvbSBcIi4vb3B0aW9uc1wiO1xuaW1wb3J0IHR5cGUge1xuICAgIENsZWFuT3B0aW9ucyxcbiAgICBSZWNyZWF0ZU9wdGlvbnMsXG4gICAgUmVzdGFydE9wdGlvbnMsIFNldE5ldHdvcmtPcHRpb25zLFxuICAgIFNldHVwT3B0aW9ucywgU29sT3B0aW9ucyxcbiAgICBTdGFydE9wdGlvbnMsXG4gICAgU3RvcE9wdGlvbnMsXG4gICAgVXNlT3B0aW9ucywgV2ViT3B0aW9ucyxcbn0gZnJvbSBcIi4vb3B0aW9uc1wiO1xuXG5pbXBvcnQgeyBpbmZvQ29tbWFuZCB9IGZyb20gXCIuL2luZm8uanNcIjtcbmltcG9ydCB7IHNweSB9IGZyb20gXCIuL3NweVwiO1xuXG5jb25zdCBVU0VfRVhQRVJJTUVOVEFMX0ZFQVRVUkVTID0gZmFsc2U7XG5cbmNvbnN0IHByb2dyYW0gPSByZXF1aXJlKCdjb21tYW5kZXInKTtcblxuXG5hc3luYyBmdW5jdGlvbiBzZXR1cENvbW1hbmQoZGV2OiBEZXYsIG9wdGlvbnM6IFNldHVwT3B0aW9ucykge1xuICAgIGF3YWl0IGRldi5zdGFydChjb21waWxlcnNXaXRoTmV0d29ya3MoZGV2LCBvcHRpb25zKSk7XG59XG5cblxuYXN5bmMgZnVuY3Rpb24gc3RhcnRDb21tYW5kKGRldjogRGV2LCBvcHRpb25zOiBTdGFydE9wdGlvbnMpIHtcbiAgICBhd2FpdCBkZXYuc3RhcnQoY29tcGlsZXJzV2l0aE5ldHdvcmtzKGRldiwgb3B0aW9ucykpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdG9wQ29tbWFuZChkZXY6IERldiwgb3B0aW9uczogU3RvcE9wdGlvbnMpIHtcbiAgICBhd2FpdCBkZXYuc3RvcChjb21waWxlcnNXaXRoTmV0d29ya3MoZGV2LCBvcHRpb25zKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJlc3RhcnRDb21tYW5kKGRldjogRGV2LCBvcHRpb25zOiBSZXN0YXJ0T3B0aW9ucykge1xuICAgIGF3YWl0IGRldi5yZXN0YXJ0KGNvbXBpbGVyc1dpdGhOZXR3b3JrcyhkZXYsIG9wdGlvbnMpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcmVjcmVhdGVDb21tYW5kKGRldjogRGV2LCBvcHRpb25zOiBSZWNyZWF0ZU9wdGlvbnMpIHtcbiAgICBhd2FpdCBkZXYucmVjcmVhdGUoY29tcGlsZXJzV2l0aE5ldHdvcmtzKGRldiwgb3B0aW9ucykpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjbGVhbkNvbW1hbmQoZGV2OiBEZXYsIG9wdGlvbnM6IENsZWFuT3B0aW9ucykge1xuICAgIGNvbnN0IGFsbCA9ICFvcHRpb25zLmNvbXBpbGVycyAmJiAhb3B0aW9ucy5uZXR3b3JrcztcbiAgICBhd2FpdCBkZXYuY2xlYW4oXG4gICAgICAgIG9wdGlvbnMuY29tcGlsZXJzIHx8IGFsbCxcbiAgICAgICAgb3B0aW9ucy5uZXR3b3JrcyB8fCBhbGwsXG4gICAgICAgIG9wdGlvbnMuY29udGFpbmVycyxcbiAgICApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZXRDb21tYW5kKGRldjogRGV2LCBuYW1lczogc3RyaW5nW10sIG9wdGlvbnM6IFNldE5ldHdvcmtPcHRpb25zKSB7XG4gICAgYXdhaXQgZGV2LnVwZGF0ZU5ldHdvcmtDb25maWdzKGRldi5uZXR3b3Jrc09yQWxsKG5hbWVzKSwgKGNvbmZpZzogTmV0d29ya0NvbmZpZykgPT4ge1xuICAgICAgICBpZiAob3B0aW9ucy5uZXdOYW1lKSB7XG4gICAgICAgICAgICBjb25maWcubmFtZSA9IG9wdGlvbnMubmV3TmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5wb3J0KSB7XG4gICAgICAgICAgICBjb25maWcuaG9zdFBvcnQgPSBvcHRpb25zLnBvcnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuZGJQb3J0KSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5kYlBvcnQgPT09ICdiaW5kJykge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5hcmFuZ29Ib3N0UG9ydCA9IE5ldHdvcmsuZGVmYXVsdEFyYW5nb1BvcnQ7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuZGJQb3J0ID09PSAndW5iaW5kJykge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5hcmFuZ29Ib3N0UG9ydCA9ICcnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25maWcuYXJhbmdvSG9zdFBvcnQgPSBvcHRpb25zLmRiUG9ydCB8fCAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBhZGRDb21tYW5kKGRldjogRGV2LCBuYW1lczogc3RyaW5nW10pIHtcbiAgICBhd2FpdCBkZXYuYWRkTmV0d29ya3MobmFtZXMpO1xufVxuXG5hc3luYyBmdW5jdGlvbiByZW1vdmVDb21tYW5kKGRldjogRGV2LCBuYW1lczogc3RyaW5nW10pIHtcbiAgICBhd2FpdCBkZXYucmVtb3ZlTmV0d29ya3MoZGV2Lm5ldHdvcmtzRnJvbU5hbWVzKG5hbWVzKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlS2V5c0NvbW1hbmQoX2RldjogRGV2KSB7XG4gICAgY29uc3QgY2xpZW50ID0gYXdhaXQgVE9OQ2xpZW50LmNyZWF0ZSh7XG4gICAgICAgIHNlcnZlcnM6IFsnaHR0cDovL2xvY2FsaG9zdCddLFxuICAgIH0pO1xuICAgIGNvbnN0IGtleXMgPSBhd2FpdCBjbGllbnQuY3J5cHRvLmVkMjU1MTlLZXlwYWlyKCk7XG4gICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoa2V5cywgdW5kZWZpbmVkLCA0KSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNvbnZlcnRBZGRyZXNzKF9kZXY6IERldiwgYWRkcikge1xuICAgIGNvbnN0IGNsaWVudCA9IGF3YWl0IFRPTkNsaWVudC5jcmVhdGUoe1xuICAgICAgICBzZXJ2ZXJzOiBbJ2h0dHA6Ly9sb2NhbGhvc3QnXSxcbiAgICB9KTtcbiAgICBjb25zdCBzaG93Q29udmVydGVkID0gKHRpdGxlLCBjb252ZXJ0ZWQpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coYCR7Y29udmVydGVkLmFkZHJlc3MgPT09IGFkZHIgPyAn4pyTJyA6ICcgJ30gJHt0aXRsZX0gPSAke2NvbnZlcnRlZC5hZGRyZXNzfWApO1xuICAgIH07XG4gICAgY29uc3Qgc2hvd0hleCA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgY29udmVydGVkID0gYXdhaXQgY2xpZW50LmNvbnRyYWN0cy5jb252ZXJ0QWRkcmVzcyh7XG4gICAgICAgICAgICBhZGRyZXNzOiBhZGRyLFxuICAgICAgICAgICAgY29udmVydFRvOiAnSGV4JyxcbiAgICAgICAgfSk7XG4gICAgICAgIHNob3dDb252ZXJ0ZWQoJ2hleCcsIGNvbnZlcnRlZCk7XG4gICAgfTtcbiAgICBjb25zdCBzaG93QmFzZTY0ID0gYXN5bmMgKHRlc3QsIGJvdW5jZSwgdXJsKSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbnZlcnRlZCA9IGF3YWl0IGNsaWVudC5jb250cmFjdHMuY29udmVydEFkZHJlc3Moe1xuICAgICAgICAgICAgYWRkcmVzczogYWRkcixcbiAgICAgICAgICAgIGNvbnZlcnRUbzogJ0Jhc2U2NCcsXG4gICAgICAgICAgICBiYXNlNjRQYXJhbXM6IHtcbiAgICAgICAgICAgICAgICBib3VuY2UsXG4gICAgICAgICAgICAgICAgdGVzdCxcbiAgICAgICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgZmxhZ3MgPSBbXG4gICAgICAgICAgICB0ZXN0ID8gJ3Rlc3QnIDogJ21haW4nLFxuICAgICAgICAgICAgYm91bmNlID8gJ2JvdW5jZScgOiAnJyxcbiAgICAgICAgICAgIHVybCA/ICd1cmwnIDogJycsXG4gICAgICAgIF1cbiAgICAgICAgICAgIC5maWx0ZXIoeCA9PiB4ICE9PSAnJylcbiAgICAgICAgICAgIC5qb2luKCcgJyk7XG4gICAgICAgIHNob3dDb252ZXJ0ZWQoZmxhZ3MsIGNvbnZlcnRlZCk7XG4gICAgfTtcbiAgICBhd2FpdCBzaG93SGV4KCk7XG4gICAgYXdhaXQgc2hvd0Jhc2U2NChmYWxzZSwgZmFsc2UsIGZhbHNlKTtcbiAgICBhd2FpdCBzaG93QmFzZTY0KGZhbHNlLCBmYWxzZSwgdHJ1ZSk7XG4gICAgYXdhaXQgc2hvd0Jhc2U2NChmYWxzZSwgdHJ1ZSwgZmFsc2UpO1xuICAgIGF3YWl0IHNob3dCYXNlNjQoZmFsc2UsIHRydWUsIHRydWUpO1xuICAgIGF3YWl0IHNob3dCYXNlNjQodHJ1ZSwgZmFsc2UsIGZhbHNlKTtcbiAgICBhd2FpdCBzaG93QmFzZTY0KHRydWUsIGZhbHNlLCB0cnVlKTtcbiAgICBhd2FpdCBzaG93QmFzZTY0KHRydWUsIHRydWUsIGZhbHNlKTtcbiAgICBhd2FpdCBzaG93QmFzZTY0KHRydWUsIHRydWUsIHRydWUpO1xufVxuXG5hc3luYyBmdW5jdGlvbiB1c2VDb21tYW5kKGRldjogRGV2LCB2ZXJzaW9uOiBzdHJpbmcsIG9wdGlvbnM6IFVzZU9wdGlvbnMpIHtcbiAgICBhd2FpdCBkZXYudXNlVmVyc2lvbih2ZXJzaW9uLCBjb21waWxlcnNXaXRoTmV0d29ya3MoZGV2LCBvcHRpb25zKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNvbENvbW1hbmQoZGV2OiBEZXYsIGZpbGVzOiBzdHJpbmdbXSwgb3B0aW9uczogU29sT3B0aW9ucykge1xuICAgIGlmIChmaWxlcy5sZW5ndGggPCAxKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IG11c3Qgc3BlY2lmeSBhdCBsZWFzdCBvbmUgZmlsZSBuYW1lJyk7XG4gICAgfVxuICAgIGF3YWl0IFNvbGlkaXR5LmJ1aWxkKGRldiwgZmlsZXMsIHtcbiAgICAgICAgY2xpZW50TGFuZ3VhZ2VzOiAob3B0aW9ucy5jbGllbnRMYW5ndWFnZXMgfHwgJycpLnNwbGl0KCcsJykuZmlsdGVyKHggPT4geCksXG4gICAgICAgIGNsaWVudExldmVsOiBvcHRpb25zLmNsaWVudExldmVsIHx8IENsaWVudENvZGVMZXZlbC5ydW4sXG4gICAgICAgIGpzTW9kdWxlOiBvcHRpb25zLmpzTW9kdWxlIHx8IEpTTW9kdWxlLm5vZGUsXG4gICAgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdlbkNvbW1hbmQoZGV2OiBEZXYsIGZpbGVzOiBzdHJpbmdbXSwgb3B0aW9uczogU29sT3B0aW9ucykge1xuICAgIGlmIChmaWxlcy5sZW5ndGggPCAxKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IG11c3Qgc3BlY2lmeSBhdCBsZWFzdCBvbmUgZmlsZSBuYW1lJyk7XG4gICAgfVxuICAgIGF3YWl0IENsaWVudENvZGUuZ2VuZXJhdGUoZmlsZXMsIHtcbiAgICAgICAgY2xpZW50TGFuZ3VhZ2VzOiAob3B0aW9ucy5jbGllbnRMYW5ndWFnZXMgfHwgJycpLnNwbGl0KCcsJyksXG4gICAgICAgIGNsaWVudExldmVsOiBvcHRpb25zLmNsaWVudExldmVsIHx8IENsaWVudENvZGVMZXZlbC5ydW4sXG4gICAgICAgIGpzTW9kdWxlOiBvcHRpb25zLmpzTW9kdWxlIHx8IEpTTW9kdWxlLm5vZGUsXG4gICAgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNweUNvbW1hbmQoZGV2OiBEZXYsIG5ldHdvcmtzOiBzdHJpbmdbXSkge1xuICAgIGF3YWl0IHNweShkZXYsIG5ldHdvcmtzKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gd2ViQ29uc29sZUNvbW1hbmQoZGV2OiBEZXYsIG9wdGlvbnM6IFdlYk9wdGlvbnMpIHtcbiAgICBhd2FpdCB3ZWIoZGV2LCBvcHRpb25zKTtcbn1cblxuY29uc3QgbmV0d29ya3NPcHRpb24gPSBbXG4gICAgJy1uLCAtLW5ldHdvcmtzIFtuYW1lc10nLFxuICAgICdBcHBseSBjb21tYW5kIHRvIHNwZWNpZmllZCBuZXR3b3JrW3NdIChuYW1lcyBtdXN0IGJlIHNlcGFyYXRlZCB3aXRoIGNvbW1hKS4nXG5dO1xuXG5jb25zdCBjb21waWxlcnNPcHRpb24gPSBbXG4gICAgJy1tLCAtLWNvbXBpbGVycycsXG4gICAgJ0FwcGx5IGNvbW1hbmQgdG8gdGhlIGNvbXBpbGVycyBjb250YWluZXIuJ1xuXTtcblxuZnVuY3Rpb24gZ2V0U3VwcG9ydGVkTGFuZ3VhZ2VzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhDbGllbnRDb2RlLmxhbmd1YWdlcykubWFwKCh4OiBhbnkpID0+IHguc2hvcnROYW1lKTtcbn1cblxuY29uc3QgY2xpZW50TGFuZ3VhZ2VzT3B0aW9uID0gW1xuICAgICctbCwgLS1jbGllbnQtbGFuZ3VhZ2VzIDxsYW5ndWFnZXM+JyxcbiAgICBgR2VuZXJhdGUgY2xpZW50IGNvZGUgZm9yIHNwZWNpZmllZCBsYW5ndWFnZXMgc2VwYXJhdGVkIGJ5IGNvbW1hLCBgICtcbiAgICBgc3VwcG9ydGVkIGxhbmd1YWdlczogXCIke2dldFN1cHBvcnRlZExhbmd1YWdlcygpLmpvaW4oJ1wiLCBcIicpfVwiLmAsXG5dO1xuXG5jb25zdCBjbGllbnRMZXZlbE9wdGlvbiA9IFtcbiAgICAnLUwsIC0tY2xpZW50LWxldmVsIDxjbGllbnQtbGV2ZWw+JyxcbiAgICAnQ2xpZW50IGNvZGUgbGV2ZWw6ICcgK1xuICAgICdcInJ1blwiIHRvIHJ1biBvbmx5LCAnICtcbiAgICAnXCJkZXBsb3lcIiB0byBydW4gYW5kIGRlcGxveSAoaW5jbHVkZXMgYW4gaW1hZ2VCYXNlNjQgb2YgYmluYXJ5IGNvbnRyYWN0KScsXG4gICAgJ2RlcGxveSdcbl07XG5cbmNvbnN0IGpzTW9kdWxlVHlwZU9wdGlvbiA9IFtcbiAgICAnLS1qcy1tb2R1bGUgPG1vZHVsZS10eXBlPicsXG4gICAgXCJKYXZhIFNjcmlwdCBtb2R1bGUgdHlwZTogXCIgK1xuICAgIFwiYG5vZGVgIHRvIHVzZSB3aXRoIGBjb25zdCBGb29Db250cmFjdCA9IHJlcXVpcmUoJ2ZvbycpYCwgXCIgK1xuICAgIFwiYG5vZGVOb0RlZmF1bHRgIHRvIHVzZSB3aXRoIGBjb25zdCB7Rm9vQ29udHJhY3R9ID0gcmVxdWlyZSgnZm9vJylgLCBcIiArXG4gICAgXCJgZXNgIHRvIHVzZSB3aXRoIGBpbXBvcnQgRm9vQ29udHJhY3QgZnJvbSAnZm9vJ2AsIFwiICtcbiAgICBcImBlc05vRGVmYXVsdGAgdG8gdXNlIHdpdGggYGltcG9ydCB7Rm9vQ29udHJhY3R9IGZyb20gJ2ZvbydgLlwiLFxuICAgICdub2RlJ1xuXTtcblxuXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVDb21tYW5kTGluZShkZXY6IERldiwgYXJnczogc3RyaW5nW10pIHtcbiAgICBsZXQgY29tbWFuZEFjdGlvbiA9IGluZm9Db21tYW5kO1xuICAgIGxldCBjb21tYW5kQXJncyA9IFtdO1xuXG4gICAgY29uc3QgY29tbWFuZCA9IChhY3Rpb24pID0+IHtcbiAgICAgICAgcmV0dXJuICguLi5hcmdzKSA9PiB7XG4gICAgICAgICAgICBjb21tYW5kQWN0aW9uID0gYWN0aW9uO1xuICAgICAgICAgICAgY29tbWFuZEFyZ3MgPSBhcmdzO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBwcm9ncmFtXG4gICAgICAgIC5uYW1lKGRldi5uYW1lKVxuICAgICAgICAudmVyc2lvbihkZXYudmVyc2lvbilcbiAgICAgICAgLm9wdGlvbignLWEsIC0tYXZhaWxhYmxlJywgJ1Nob3cgYXZhaWxhYmxlIHZlcnNpb25zLicpXG4gICAgICAgIC5kZXNjcmlwdGlvbignVE9OIExhYnMgZGV2ZWxvcG1lbnQgdG9vbHMnKTtcblxuICAgIHByb2dyYW1cbiAgICAgICAgLmNvbW1hbmQoJ2luZm8nLCB7IGlzRGVmYXVsdDogdHJ1ZSB9KS5kZXNjcmlwdGlvbignU2hvdyBzdW1tYXJ5IGFib3V0IGRldiBlbnZpcm9ubWVudC4nKVxuICAgICAgICAub3B0aW9uKCctYSwgLS1hdmFpbGFibGUnLCAnU2hvdyBhdmFpbGFibGUgdmVyc2lvbnMuJylcbiAgICAgICAgLmFjdGlvbihjb21tYW5kKGluZm9Db21tYW5kKSk7XG5cbiAgICBwcm9ncmFtXG4gICAgICAgIC5jb21tYW5kKCdzb2wgW2ZpbGVzLi4uXScpLmRlc2NyaXB0aW9uKCdCdWlsZCBzb2xpZGl0eSBjb250cmFjdFtzXS4nKVxuICAgICAgICAub3B0aW9uKC4uLmNsaWVudExhbmd1YWdlc09wdGlvbilcbiAgICAgICAgLm9wdGlvbiguLi5jbGllbnRMZXZlbE9wdGlvbilcbiAgICAgICAgLm9wdGlvbiguLi5qc01vZHVsZVR5cGVPcHRpb24pXG4gICAgICAgIC5hY3Rpb24oY29tbWFuZChzb2xDb21tYW5kKSk7XG5cbiAgICBwcm9ncmFtXG4gICAgICAgIC5jb21tYW5kKCdnZW4gW2ZpbGVzLi4uXScpLmRlc2NyaXB0aW9uKCdHZW5lcmF0ZSBjbGllbnQgY29kZSBmb3IgY29udHJhY3Rbc10uJylcbiAgICAgICAgLm9wdGlvbihjbGllbnRMYW5ndWFnZXNPcHRpb25bMF0sIGNsaWVudExhbmd1YWdlc09wdGlvblsxXSwgJ2pzJylcbiAgICAgICAgLm9wdGlvbiguLi5jbGllbnRMZXZlbE9wdGlvbilcbiAgICAgICAgLm9wdGlvbiguLi5qc01vZHVsZVR5cGVPcHRpb24pXG4gICAgICAgIC5hY3Rpb24oY29tbWFuZChnZW5Db21tYW5kKSk7XG5cbiAgICBwcm9ncmFtXG4gICAgICAgIC5jb21tYW5kKCdzdGFydCcpLmRlc2NyaXB0aW9uKCdTdGFydCBkZXYgY29udGFpbmVycy4nKVxuICAgICAgICAub3B0aW9uKC4uLm5ldHdvcmtzT3B0aW9uKVxuICAgICAgICAub3B0aW9uKC4uLmNvbXBpbGVyc09wdGlvbilcbiAgICAgICAgLmFjdGlvbihjb21tYW5kKHN0YXJ0Q29tbWFuZCkpO1xuXG4gICAgcHJvZ3JhbVxuICAgICAgICAuY29tbWFuZCgnc3RvcCcpLmRlc2NyaXB0aW9uKCdTdG9wIGRldiBjb250YWluZXJzLicpXG4gICAgICAgIC5vcHRpb24oLi4ubmV0d29ya3NPcHRpb24pXG4gICAgICAgIC5vcHRpb24oLi4uY29tcGlsZXJzT3B0aW9uKVxuICAgICAgICAuYWN0aW9uKGNvbW1hbmQoc3RvcENvbW1hbmQpKTtcblxuICAgIHByb2dyYW1cbiAgICAgICAgLmNvbW1hbmQoJ3Jlc3RhcnQnKS5kZXNjcmlwdGlvbignUmVzdGFydCBkZXYgY29udGFpbmVycy4nKVxuICAgICAgICAub3B0aW9uKC4uLm5ldHdvcmtzT3B0aW9uKVxuICAgICAgICAub3B0aW9uKC4uLmNvbXBpbGVyc09wdGlvbilcbiAgICAgICAgLmFjdGlvbihjb21tYW5kKHJlc3RhcnRDb21tYW5kKSk7XG5cbiAgICBwcm9ncmFtXG4gICAgICAgIC5jb21tYW5kKCdyZWNyZWF0ZScpLmRlc2NyaXB0aW9uKCdSZWNyZWF0ZSBkZXYgY29udGFpbmVycy4nKVxuICAgICAgICAub3B0aW9uKC4uLm5ldHdvcmtzT3B0aW9uKVxuICAgICAgICAub3B0aW9uKC4uLmNvbXBpbGVyc09wdGlvbilcbiAgICAgICAgLmFjdGlvbihjb21tYW5kKHJlY3JlYXRlQ29tbWFuZCkpO1xuXG4gICAgcHJvZ3JhbVxuICAgICAgICAuY29tbWFuZCgnc2V0dXAnKS5kZXNjcmlwdGlvbignU2V0dXAgZGV2IGVudmlyb25tZW50LicpXG4gICAgICAgIC5vcHRpb24oLi4ubmV0d29ya3NPcHRpb24pXG4gICAgICAgIC5vcHRpb24oLi4uY29tcGlsZXJzT3B0aW9uKVxuICAgICAgICAuYWN0aW9uKGNvbW1hbmQoc2V0dXBDb21tYW5kKSk7XG5cbiAgICBwcm9ncmFtXG4gICAgICAgIC5jb21tYW5kKCdjbGVhbicpLmRlc2NyaXB0aW9uKCdSZW1vdmUgZG9ja2VyIGNvbnRhaW5lcnMgYW5kIGltYWdlcyByZWxhdGVkIHRvIFRPTiBEZXYuJylcbiAgICAgICAgLm9wdGlvbignLW4sIC0tbmV0d29ya3MnLCAnQ2xlYW4gbG9jYWwgbm9kZSBkb2NrZXIgY29udGFpbmVycyBhbmQgaW1hZ2VzLicpXG4gICAgICAgIC5vcHRpb24oJy1tLCAtLWNvbXBpbGVycycsICdDbGVhbiBjb21waWxlcnMgZG9ja2VyIGNvbnRhaW5lcnMgYW5kIGltYWdlcy4nKVxuICAgICAgICAub3B0aW9uKCctYywgLS1jb250YWluZXJzJywgJ0NsZWFuIGNvbnRhaW5lcnMgb25seS4nLCBmYWxzZSlcbiAgICAgICAgLmFjdGlvbihjb21tYW5kKGNsZWFuQ29tbWFuZCkpO1xuXG4gICAgcHJvZ3JhbVxuICAgICAgICAuY29tbWFuZCgndXNlIDx2ZXJzaW9uPicpLmRlc2NyaXB0aW9uKCdVc2Ugc3BlY2lmaWVkIHZlcnNpb24gZm9yIGNvbnRhaW5lcnMuJylcbiAgICAgICAgLm9wdGlvbiguLi5uZXR3b3Jrc09wdGlvbilcbiAgICAgICAgLm9wdGlvbiguLi5jb21waWxlcnNPcHRpb24pXG4gICAgICAgIC5hY3Rpb24oY29tbWFuZCh1c2VDb21tYW5kKSk7XG5cbiAgICBwcm9ncmFtXG4gICAgICAgIC5jb21tYW5kKCdzZXQgW25ldHdvcmsuLi5dJykuZGVzY3JpcHRpb24oJ1NldCBuZXR3b3JrW3NdIG9wdGlvbnMuJylcbiAgICAgICAgLm9wdGlvbignLXAsIC0tcG9ydCA8cG9ydD4nLCAnSG9zdCBwb3J0IHRvIGJvdW5kIGxvY2FsIG5vZGUuJylcbiAgICAgICAgLm9wdGlvbihcbiAgICAgICAgICAgICctZCwgLS1kYi1wb3J0IDxiaW5kaW5nPicsXG4gICAgICAgICAgICAnSG9zdCBwb3J0IHRvIGJvdW5kIGxvY2FsIG5vZGVzIEFyYW5nbyBEQiAoXCJiaW5kXCIgdG8gdXNlIGRlZmF1bHQgQXJhbmdvIERCIHBvcnQsIFwidW5iaW5kXCIgdG8gdW5iaW5kIEFyYW5nbyBEQiBwb3J0KS4nLFxuICAgICAgICApXG4gICAgICAgIC5vcHRpb24oJy1uLCAtLW5ldy1uYW1lIDxuYW1lPicsICdTZXQgbmV3IG5hbWUgZm9yIG5ldHdvcmsuJylcbiAgICAgICAgLmFjdGlvbihjb21tYW5kKHNldENvbW1hbmQpKTtcblxuICAgIHByb2dyYW1cbiAgICAgICAgLmNvbW1hbmQoJ2FkZCBbbmV0d29yay4uLl0nKS5kZXNjcmlwdGlvbignQWRkIG5ldHdvcmtbc10uJylcbiAgICAgICAgLmFjdGlvbihjb21tYW5kKGFkZENvbW1hbmQpKTtcblxuICAgIHByb2dyYW1cbiAgICAgICAgLmNvbW1hbmQoJ3JlbW92ZSBbbmV0d29yay4uLl0nKS5hbGlhcygncm0nKS5kZXNjcmlwdGlvbignUmVtb3ZlIG5ldHdvcmtbc10uJylcbiAgICAgICAgLmFjdGlvbihjb21tYW5kKHJlbW92ZUNvbW1hbmQpKTtcblxuICAgIHByb2dyYW1cbiAgICAgICAgLmNvbW1hbmQoJ2tleXMnKS5hbGlhcygnaycpLmRlc2NyaXB0aW9uKCdHZW5lcmF0ZSByYW5kb20gS2V5IFBhaXIuJylcbiAgICAgICAgLmFjdGlvbihjb21tYW5kKGdlbmVyYXRlS2V5c0NvbW1hbmQpKTtcblxuICAgIHByb2dyYW1cbiAgICAgICAgLmNvbW1hbmQoJ2FkZHIgPGFkZHI+JykuYWxpYXMoJ2EnKS5kZXNjcmlwdGlvbignQ29udmVydCBhZGRyZXNzLicpXG4gICAgICAgIC5hY3Rpb24oY29tbWFuZChjb252ZXJ0QWRkcmVzcykpXG4gICAgICAgIC5hbGxvd1Vua25vd25PcHRpb24odHJ1ZSk7XG5cbiAgICBpZiAoVVNFX0VYUEVSSU1FTlRBTF9GRUFUVVJFUykge1xuICAgICAgICBwcm9ncmFtXG4gICAgICAgICAgICAuY29tbWFuZCgnc3B5IFtuZXR3b3Jrcy4uLl0nKS5kZXNjcmlwdGlvbignUnVuIG5ldHdvcmsgc2Nhbm5lci4nKVxuICAgICAgICAgICAgLmFjdGlvbihjb21tYW5kKHNweUNvbW1hbmQpKTtcblxuICAgICAgICBwcm9ncmFtXG4gICAgICAgICAgICAuY29tbWFuZCgnd2ViJykuZGVzY3JpcHRpb24oJ1J1biB3ZWIgY29uc29sZS4nKVxuICAgICAgICAgICAgLm9wdGlvbignLXAsIC0tcG9ydCA8cG9ydD4nLCAnSG9zdCBwb3J0IHRvIGJvdW5kIHdlYiBjb25zb2xlLicsICc4ODAwJylcbiAgICAgICAgICAgIC5hY3Rpb24oY29tbWFuZCh3ZWJDb25zb2xlQ29tbWFuZCkpO1xuXG5cbiAgICB9XG5cbiAgICBwcm9ncmFtLnBhcnNlKGFyZ3MpO1xuXG4gICAgaWYgKGNvbW1hbmRBcmdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBpZiAocHJvZ3JhbS5hcmdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgYXdhaXQgaW5mb0NvbW1hbmQoZGV2LCBwcm9ncmFtKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHByb2dyYW0ub3V0cHV0SGVscCgpO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGNvbW1hbmRBY3Rpb24gPT09IGluZm9Db21tYW5kKSB7XG4gICAgICAgICAgICBjb25zdCBvcHRpb25zID0gY29tbWFuZEFyZ3NbY29tbWFuZEFyZ3MubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICBvcHRpb25zLmF2YWlsYWJsZSA9IG9wdGlvbnMucGFyZW50LmF2YWlsYWJsZTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCBjb21tYW5kQWN0aW9uKGRldiwgLi4uY29tbWFuZEFyZ3MpO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgaGFuZGxlQ29tbWFuZExpbmUgfTtcbiJdfQ==