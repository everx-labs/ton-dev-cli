"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.NetworkTracer = void 0;

var _tonClientNodeJs = require("ton-client-node-js");

var _utils = require("../utils/utils");

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const os = require('os');

const fs = require('fs');

const path = require('path');

class NetworkTracer {
  static async traceNetwork(server) {
    await NetworkTracer.resolveGiverParameters();
    const tracer = new NetworkTracer(server);
    await tracer.check();
  }

  constructor(server) {
    _defineProperty(this, "server", void 0);

    _defineProperty(this, "client", void 0);

    _defineProperty(this, "message", void 0);

    _defineProperty(this, "succeeded", void 0);

    _defineProperty(this, "failed", void 0);

    this.server = server;
    this.message = '';
    this.succeeded = false;
    this.failed = false;
  }

  async check() {
    this.client = await _tonClientNodeJs.TONClient.create({
      servers: [this.server],
      log_verbose: true
    });

    try {
      await this.checkGiver();
      await this.checkSendGrams();
      this.report({
        succeeded: true
      });
    } catch (error) {
      this.report({
        error
      });
    }
  }

  async checkGiver() {
    this.report({
      message: 'looking for giver'
    });
    const givers = await this.client.queries.accounts.query({
      id: {
        eq: NetworkTracer.giverAddress
      }
    }, 'balance code');

    if (givers.length < 1) {
      this.report({
        error: 'no giver'
      });
      return;
    } //$FlowFixMe


    const giverBalance = BigInt(givers[0].balance);

    if (giverBalance === BigInt(0)) {
      this.report({
        error: 'giver balance is empty'
      });
      return;
    }

    if (giverBalance < BigInt(1000000000)) {
      this.report({
        error: `giver balance too low: ${giverBalance}`
      });
      return;
    }

    if (!givers[0].code) {
      this.report({
        message: `deploying giver, balance: ${giverBalance}`
      });
      await this.client.contracts.deploy({
        package: NetworkTracer.giverPackage,
        keyPair: NetworkTracer.giverKeys,
        constructorParams: {}
      });
      this.report({
        succeeded: true
      });
    }
  }

  async checkSendGrams() {
    this.report({
      message: 'sending 0.001G'
    });
    const message = await this.client.contracts.createRunMessage({
      address: NetworkTracer.giverAddress,
      functionName: 'sendTransaction',
      abi: NetworkTracer.giverPackage.abi,
      input: {
        dest: '0:adb63a228837e478c7edf5fe3f0b5d12183e1f22246b67712b99ec538d6c5357',
        value: 1000000,
        bounce: false
      },
      keyPair: NetworkTracer.giverKeys
    });
    console.log(`Message ID: ${message.message.messageId}`);
    console.log(`Press [Return] to send...`);
    await (0, _utils.inputLine)();
    const result = await this.client.contracts.processRunMessage(message);

    if (result && result.transaction) {
      console.log('>>>', result.transaction);
    }
  }

  isFinished() {
    return this.succeeded || this.failed;
  }

  getStatus() {
    let status = '  ';
    let message = '';

    if (this.isFinished()) {
      status = this.succeeded ? '✓ ' : '✖ ';
    }

    if (!this.succeeded) {
      message = this.message !== '' ? ` … ${this.message}` : '';
    }

    return `${status}${message}`;
  }

  report(options) {
    if (options.succeeded !== undefined) {
      this.succeeded = options.succeeded;
      this.failed = false;
      this.message = '';
    } else if (options.error !== undefined) {
      this.message = options.error && options.error.message ? options.error.message : (options.error || '').toString();
      this.failed = true;
      this.succeeded = false;
    } else if (options.message !== undefined && !this.isFinished()) {
      this.message = options.message;
    }

    console.log(this.getStatus());
  }

  static async resolveGiverParameters() {
    const client = await _tonClientNodeJs.TONClient.create({
      servers: ['net.ton.dev']
    });

    try {
      let keysPath = path.resolve(os.homedir(), 'giverKeys.json');
      NetworkTracer.giverKeys = JSON.parse(fs.readFileSync(keysPath, 'utf8'));
    } catch (error) {}

    NetworkTracer.giverAddress = (await client.contracts.createDeployMessage({
      package: NetworkTracer.giverPackage,
      constructorParams: {},
      keyPair: NetworkTracer.giverKeys
    })).address;
  }

}

exports.NetworkTracer = NetworkTracer;

_defineProperty(NetworkTracer, "giverAddress", '0:5b168970a9c63dd5c42a6afbcf706ef652476bb8960a22e1d8a2ad148e60c0ea');

_defineProperty(NetworkTracer, "giverKeys", {
  secret: '2245e4f44af8af6bbd15c4a53eb67a8f211d541ddc7c197f74d7830dba6d27fe',
  public: 'd542f44146f169c6726c8cf70e4cbb3d33d8d842a4afd799ac122c5808d81ba3'
});

_defineProperty(NetworkTracer, "giverPackage", {
  abi: {
    "ABI version": 1,
    "functions": [{
      "name": "constructor",
      "inputs": [],
      "outputs": []
    }, {
      "name": "sendTransaction",
      "inputs": [{
        "name": "dest",
        "type": "address"
      }, {
        "name": "value",
        "type": "uint128"
      }, {
        "name": "bounce",
        "type": "bool"
      }],
      "outputs": []
    }],
    "events": [],
    "data": [{
      "key": 100,
      "name": "owner",
      "type": "uint256"
    }]
  },
  imageBase64: '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'
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jbGkvdHJhY2UuanMiXSwibmFtZXMiOlsib3MiLCJyZXF1aXJlIiwiZnMiLCJwYXRoIiwiTmV0d29ya1RyYWNlciIsInRyYWNlTmV0d29yayIsInNlcnZlciIsInJlc29sdmVHaXZlclBhcmFtZXRlcnMiLCJ0cmFjZXIiLCJjaGVjayIsImNvbnN0cnVjdG9yIiwibWVzc2FnZSIsInN1Y2NlZWRlZCIsImZhaWxlZCIsImNsaWVudCIsIlRPTkNsaWVudE5vZGVKcyIsImNyZWF0ZSIsInNlcnZlcnMiLCJsb2dfdmVyYm9zZSIsImNoZWNrR2l2ZXIiLCJjaGVja1NlbmRHcmFtcyIsInJlcG9ydCIsImVycm9yIiwiZ2l2ZXJzIiwicXVlcmllcyIsImFjY291bnRzIiwicXVlcnkiLCJpZCIsImVxIiwiZ2l2ZXJBZGRyZXNzIiwibGVuZ3RoIiwiZ2l2ZXJCYWxhbmNlIiwiQmlnSW50IiwiYmFsYW5jZSIsImNvZGUiLCJjb250cmFjdHMiLCJkZXBsb3kiLCJwYWNrYWdlIiwiZ2l2ZXJQYWNrYWdlIiwia2V5UGFpciIsImdpdmVyS2V5cyIsImNvbnN0cnVjdG9yUGFyYW1zIiwiY3JlYXRlUnVuTWVzc2FnZSIsImFkZHJlc3MiLCJmdW5jdGlvbk5hbWUiLCJhYmkiLCJpbnB1dCIsImRlc3QiLCJ2YWx1ZSIsImJvdW5jZSIsImNvbnNvbGUiLCJsb2ciLCJtZXNzYWdlSWQiLCJyZXN1bHQiLCJwcm9jZXNzUnVuTWVzc2FnZSIsInRyYW5zYWN0aW9uIiwiaXNGaW5pc2hlZCIsImdldFN0YXR1cyIsInN0YXR1cyIsIm9wdGlvbnMiLCJ1bmRlZmluZWQiLCJ0b1N0cmluZyIsImtleXNQYXRoIiwicmVzb2x2ZSIsImhvbWVkaXIiLCJKU09OIiwicGFyc2UiLCJyZWFkRmlsZVN5bmMiLCJjcmVhdGVEZXBsb3lNZXNzYWdlIiwic2VjcmV0IiwicHVibGljIiwiaW1hZ2VCYXNlNjQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFnQkE7O0FBRUE7Ozs7QUFFQSxNQUFN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ZSxDQURkO0FBRUQsaUJBQWEsQ0FDVDtBQUNJLGNBQVEsYUFEWjtBQUVJLGdCQUFVLEVBRmQ7QUFHSSxpQkFBVztBQUhmLEtBRFMsRUFNVDtBQUNJLGNBQVEsaUJBRFo7QUFFSSxnQkFBVSxDQUNOO0FBQUUsZ0JBQVEsTUFBVjtBQUFrQixnQkFBUTtBQUExQixPQURNLEVBRU47QUFBRSxnQkFBUSxPQUFWO0FBQW1CLGdCQUFRO0FBQTNCLE9BRk0sRUFHTjtBQUFFLGdCQUFRLFFBQVY7QUFBb0IsZ0JBQVE7QUFBNUIsT0FITSxDQUZkO0FBT0ksaUJBQVc7QUFQZixLQU5TLENBRlo7QUFrQkQsY0FBVSxFQWxCVDtBQW1CRCxZQUFRLENBQ0o7QUFBRSxhQUFPLEdBQVQ7QUFBYyxjQUFRLE9BQXRCO0FBQStCLGNBQVE7QUFBdkMsS0FESTtBQW5CUCxHQURhO0FBd0JsQjBCLEVBQUFBLFdBQVcsRUFBRTtBQXhCSyxDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDE4LTIwMjAgVE9OIERFViBTT0xVVElPTlMgTFRELlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBTT0ZUV0FSRSBFVkFMVUFUSU9OIExpY2Vuc2UgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZVxuICogdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlXG4gKiBMaWNlbnNlIGF0OiBodHRwczovL3d3dy50b24uZGV2L2xpY2Vuc2VzXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBUT04gREVWIHNvZnR3YXJlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICpcbiAqL1xuXG4vLyBAZmxvd1xuaW1wb3J0IHsgVE9OQ2xpZW50IGFzIFRPTkNsaWVudE5vZGVKcyB9IGZyb20gXCJ0b24tY2xpZW50LW5vZGUtanNcIjtcbmltcG9ydCB0eXBlIHsgVE9OQ2xpZW50IH0gZnJvbSBcInRvbi1jbGllbnQtanMvdHlwZXNcIjtcbmltcG9ydCB7IGlucHV0TGluZSB9IGZyb20gXCIuLi91dGlscy91dGlsc1wiO1xuXG5jb25zdCBvcyA9IHJlcXVpcmUoJ29zJyk7XG5jb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuXG5leHBvcnQgY2xhc3MgTmV0d29ya1RyYWNlciB7XG4gICAgc3RhdGljIGFzeW5jIHRyYWNlTmV0d29yayhzZXJ2ZXI6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCBOZXR3b3JrVHJhY2VyLnJlc29sdmVHaXZlclBhcmFtZXRlcnMoKTtcbiAgICAgICAgY29uc3QgdHJhY2VyOiBOZXR3b3JrVHJhY2VyID0gbmV3IE5ldHdvcmtUcmFjZXIoc2VydmVyKTtcbiAgICAgICAgYXdhaXQgdHJhY2VyLmNoZWNrKCk7XG4gICAgfVxuXG4gICAgc2VydmVyOiBzdHJpbmc7XG4gICAgY2xpZW50OiBUT05DbGllbnQ7XG5cbiAgICBtZXNzYWdlOiBzdHJpbmc7XG4gICAgc3VjY2VlZGVkOiBib29sZWFuO1xuICAgIGZhaWxlZDogYm9vbGVhbjtcblxuICAgIGNvbnN0cnVjdG9yKHNlcnZlcjogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyO1xuICAgICAgICB0aGlzLm1lc3NhZ2UgPSAnJztcbiAgICAgICAgdGhpcy5zdWNjZWVkZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mYWlsZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBhc3luYyBjaGVjaygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdGhpcy5jbGllbnQgPSBhd2FpdCBUT05DbGllbnROb2RlSnMuY3JlYXRlKHtcbiAgICAgICAgICAgIHNlcnZlcnM6IFt0aGlzLnNlcnZlcl0sXG4gICAgICAgICAgICBsb2dfdmVyYm9zZTogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmNoZWNrR2l2ZXIoKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuY2hlY2tTZW5kR3JhbXMoKTtcbiAgICAgICAgICAgIHRoaXMucmVwb3J0KHsgc3VjY2VlZGVkOiB0cnVlIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgdGhpcy5yZXBvcnQoeyBlcnJvciB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGNoZWNrR2l2ZXIoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHRoaXMucmVwb3J0KHsgbWVzc2FnZTogJ2xvb2tpbmcgZm9yIGdpdmVyJyB9KTtcbiAgICAgICAgY29uc3QgZ2l2ZXJzID0gYXdhaXQgdGhpcy5jbGllbnQucXVlcmllcy5hY2NvdW50cy5xdWVyeShcbiAgICAgICAgICAgIHsgaWQ6IHsgZXE6IE5ldHdvcmtUcmFjZXIuZ2l2ZXJBZGRyZXNzIH0gfSxcbiAgICAgICAgICAgICdiYWxhbmNlIGNvZGUnKTtcbiAgICAgICAgaWYgKGdpdmVycy5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICB0aGlzLnJlcG9ydCh7IGVycm9yOiAnbm8gZ2l2ZXInIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vJEZsb3dGaXhNZVxuICAgICAgICBjb25zdCBnaXZlckJhbGFuY2UgPSBCaWdJbnQoZ2l2ZXJzWzBdLmJhbGFuY2UpO1xuICAgICAgICBpZiAoZ2l2ZXJCYWxhbmNlID09PSBCaWdJbnQoMCkpIHtcbiAgICAgICAgICAgIHRoaXMucmVwb3J0KHsgZXJyb3I6ICdnaXZlciBiYWxhbmNlIGlzIGVtcHR5JyB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZ2l2ZXJCYWxhbmNlIDwgQmlnSW50KDFfMDAwXzAwMF8wMDApKSB7XG4gICAgICAgICAgICB0aGlzLnJlcG9ydCh7IGVycm9yOiBgZ2l2ZXIgYmFsYW5jZSB0b28gbG93OiAke2dpdmVyQmFsYW5jZX1gIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZ2l2ZXJzWzBdLmNvZGUpIHtcbiAgICAgICAgICAgIHRoaXMucmVwb3J0KHsgbWVzc2FnZTogYGRlcGxveWluZyBnaXZlciwgYmFsYW5jZTogJHtnaXZlckJhbGFuY2V9YCB9KTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuY2xpZW50LmNvbnRyYWN0cy5kZXBsb3koe1xuICAgICAgICAgICAgICAgIHBhY2thZ2U6IE5ldHdvcmtUcmFjZXIuZ2l2ZXJQYWNrYWdlLFxuICAgICAgICAgICAgICAgIGtleVBhaXI6IE5ldHdvcmtUcmFjZXIuZ2l2ZXJLZXlzLFxuICAgICAgICAgICAgICAgIGNvbnN0cnVjdG9yUGFyYW1zOiB7fSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5yZXBvcnQoeyBzdWNjZWVkZWQ6IHRydWUgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBjaGVja1NlbmRHcmFtcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdGhpcy5yZXBvcnQoeyBtZXNzYWdlOiAnc2VuZGluZyAwLjAwMUcnIH0pO1xuICAgICAgICBjb25zdCBtZXNzYWdlID0gYXdhaXQgdGhpcy5jbGllbnQuY29udHJhY3RzLmNyZWF0ZVJ1bk1lc3NhZ2Uoe1xuICAgICAgICAgICAgYWRkcmVzczogTmV0d29ya1RyYWNlci5naXZlckFkZHJlc3MsXG4gICAgICAgICAgICBmdW5jdGlvbk5hbWU6ICdzZW5kVHJhbnNhY3Rpb24nLFxuICAgICAgICAgICAgYWJpOiBOZXR3b3JrVHJhY2VyLmdpdmVyUGFja2FnZS5hYmksXG4gICAgICAgICAgICBpbnB1dDoge1xuICAgICAgICAgICAgICAgIGRlc3Q6ICcwOmFkYjYzYTIyODgzN2U0NzhjN2VkZjVmZTNmMGI1ZDEyMTgzZTFmMjIyNDZiNjc3MTJiOTllYzUzOGQ2YzUzNTcnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAxXzAwMF8wMDAsXG4gICAgICAgICAgICAgICAgYm91bmNlOiBmYWxzZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGtleVBhaXI6IE5ldHdvcmtUcmFjZXIuZ2l2ZXJLZXlzLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc29sZS5sb2coYE1lc3NhZ2UgSUQ6ICR7bWVzc2FnZS5tZXNzYWdlLm1lc3NhZ2VJZH1gKTtcbiAgICAgICAgY29uc29sZS5sb2coYFByZXNzIFtSZXR1cm5dIHRvIHNlbmQuLi5gKTtcbiAgICAgICAgYXdhaXQgaW5wdXRMaW5lKCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY2xpZW50LmNvbnRyYWN0cy5wcm9jZXNzUnVuTWVzc2FnZShtZXNzYWdlKTtcbiAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQudHJhbnNhY3Rpb24pIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCc+Pj4nLCByZXN1bHQudHJhbnNhY3Rpb24pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaXNGaW5pc2hlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3VjY2VlZGVkIHx8IHRoaXMuZmFpbGVkO1xuICAgIH1cblxuICAgIGdldFN0YXR1cygpIHtcbiAgICAgICAgbGV0IHN0YXR1cyA9ICcgICc7XG4gICAgICAgIGxldCBtZXNzYWdlID0gJyc7XG4gICAgICAgIGlmICh0aGlzLmlzRmluaXNoZWQoKSkge1xuICAgICAgICAgICAgc3RhdHVzID0gdGhpcy5zdWNjZWVkZWQgPyAn4pyTICcgOiAn4pyWICc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLnN1Y2NlZWRlZCkge1xuICAgICAgICAgICAgbWVzc2FnZSA9IHRoaXMubWVzc2FnZSAhPT0gJycgPyBgIOKApiAke3RoaXMubWVzc2FnZX1gIDogJyc7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGAke3N0YXR1c30ke21lc3NhZ2V9YDtcbiAgICB9XG5cbiAgICByZXBvcnQob3B0aW9uczoge1xuICAgICAgICBzdWNjZWVkZWQ/OiBib29sZWFuLFxuICAgICAgICBlcnJvcj86IGFueSxcbiAgICAgICAgbWVzc2FnZT86IHN0cmluZyxcbiAgICB9KSB7XG4gICAgICAgIGlmIChvcHRpb25zLnN1Y2NlZWRlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnN1Y2NlZWRlZCA9IG9wdGlvbnMuc3VjY2VlZGVkO1xuICAgICAgICAgICAgdGhpcy5mYWlsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZSA9ICcnO1xuICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuZXJyb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gKG9wdGlvbnMuZXJyb3IgJiYgb3B0aW9ucy5lcnJvci5tZXNzYWdlKVxuICAgICAgICAgICAgICAgID8gb3B0aW9ucy5lcnJvci5tZXNzYWdlXG4gICAgICAgICAgICAgICAgOiAob3B0aW9ucy5lcnJvciB8fCAnJykudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIHRoaXMuZmFpbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuc3VjY2VlZGVkID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5tZXNzYWdlICE9PSB1bmRlZmluZWQgJiYgIXRoaXMuaXNGaW5pc2hlZCgpKSB7XG4gICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBvcHRpb25zLm1lc3NhZ2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2codGhpcy5nZXRTdGF0dXMoKSk7XG4gICAgfVxuXG4gICAgc3RhdGljIGdpdmVyQWRkcmVzcyA9ICcwOjViMTY4OTcwYTljNjNkZDVjNDJhNmFmYmNmNzA2ZWY2NTI0NzZiYjg5NjBhMjJlMWQ4YTJhZDE0OGU2MGMwZWEnO1xuICAgIHN0YXRpYyBnaXZlcktleXMgPSB7XG4gICAgICAgIHNlY3JldDogJzIyNDVlNGY0NGFmOGFmNmJiZDE1YzRhNTNlYjY3YThmMjExZDU0MWRkYzdjMTk3Zjc0ZDc4MzBkYmE2ZDI3ZmUnLFxuICAgICAgICBwdWJsaWM6ICdkNTQyZjQ0MTQ2ZjE2OWM2NzI2YzhjZjcwZTRjYmIzZDMzZDhkODQyYTRhZmQ3OTlhYzEyMmM1ODA4ZDgxYmEzJyxcbiAgICB9O1xuICAgIHN0YXRpYyBnaXZlclBhY2thZ2UgPSB7XG4gICAgICAgIGFiaToge1xuICAgICAgICAgICAgXCJBQkkgdmVyc2lvblwiOiAxLFxuICAgICAgICAgICAgXCJmdW5jdGlvbnNcIjogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiY29uc3RydWN0b3JcIixcbiAgICAgICAgICAgICAgICAgICAgXCJpbnB1dHNcIjogW10sXG4gICAgICAgICAgICAgICAgICAgIFwib3V0cHV0c1wiOiBbXVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJzZW5kVHJhbnNhY3Rpb25cIixcbiAgICAgICAgICAgICAgICAgICAgXCJpbnB1dHNcIjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgeyBcIm5hbWVcIjogXCJkZXN0XCIsIFwidHlwZVwiOiBcImFkZHJlc3NcIiB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBcIm5hbWVcIjogXCJ2YWx1ZVwiLCBcInR5cGVcIjogXCJ1aW50MTI4XCIgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgXCJuYW1lXCI6IFwiYm91bmNlXCIsIFwidHlwZVwiOiBcImJvb2xcIiB9XG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgIFwib3V0cHV0c1wiOiBbXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBcImV2ZW50c1wiOiBbXSxcbiAgICAgICAgICAgIFwiZGF0YVwiOiBbXG4gICAgICAgICAgICAgICAgeyBcImtleVwiOiAxMDAsIFwibmFtZVwiOiBcIm93bmVyXCIsIFwidHlwZVwiOiBcInVpbnQyNTZcIiB9XG4gICAgICAgICAgICBdXG4gICAgICAgIH0sXG4gICAgICAgIGltYWdlQmFzZTY0OiAndGU2Y2NnRUNKUUVBQmQ4QUFnRTBCZ0VCQWNBQ0FnUFBJQVVEQVFIZUJBQUQwQ0FBUWRnQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFCQUlvL3dBZ3dBSDBwQ0JZa3ZTZzRZcnRVMWd3OUtBVEJ3RUs5S1FnOUtFSUFnUE5RQkFKQWdIT0RRb0NBU0FNQ3dBSEREYk1JQUFuQ0Z3dkNMd0dibXc4dUJtSWlJaWNmQUtYd09BQ0FTQVBEZ0ExTzFIYnhGdkVNakwvNEJrN1VkdkVvQkE5RVB0UndGdlV1MVhnQU5VL3ZzQlpHVmpiMlJsWDJGa1pISWcra0F5K2tJZ2J4QWdjcm9oYzdxeDh1QjlJVzhSYnZMZ2ZjaDB6d3NDSW04U3p3b0hJbThUSW5LNmxpTnZFeUxPTXA4aGdRRUFJdGRKb2M5QU1pQWl6akxpL3Z3QlpHVmpiMlJsWDJGa1pISXdJY25RSlZWQlh3WGJNSUFJQklCSVJBQ3VrLzMyQXM3SzZMN0V3dGpDM01iTDhFN2VJYlpoQUFLV2xmMzJBc0xHdnVqa3d0em16TXJsa09XZWdFV2VGQURqbm9Id1VaNHNTWjRzUi9RRTQ1NkE0ZlFFNGZRRkFJR2VnZkJIbmhZKzVaNkFRWkpGOWdIOS9nTEN4cjdvNU1MYzVzeks1TDdLM01pK0N3QUlCSUJvVUFlRC8vdjBCYldGcGJsOWxlSFJsY201aGJDR09XZjc4QVdkbGRGOXpjbU5mWVdSa2NpRFFJTk1BTW5DOWpocisvUUZuWlhSZmMzSmpYMkZrWkhJd2NNakowRlVSWHdMYk1PQWdjdGNoTVNEVEFESWgra0F6L3YwQloyVjBYM055WTE5aFpHUnlNU0VoVlRGZkJOc3cyREVoRlFINGpuWCsvZ0ZuWlhSZmJYTm5YM0IxWW10bGVTREhBbzRXL3Y4QloyVjBYMjF6WjE5d2RXSnJaWGt4Y0RIYk1PRFZJTWNCamhmKy93Rm5aWFJmYlhOblgzQjFZbXRsZVRKd01USGJNT0FnZ1FJQTF5SFhDLzhpK1FFaUl2a1E4cWorL3dGblpYUmZiWE5uWDNCMVltdGxlVE1nQTE4RDJ6RFlJc2NDc3hZQnpKUWkxREV6M2lRaUlvNDQvdmtCYzNSdmNtVmZjMmxuYndBaGI0d2liNHdqYjR6dFJ5RnZqTzFFMFBRRmI0d2c3VmYrL1FGemRHOXlaVjl6YVdkZlpXNWtYd1hZSXNjQmpoUCsvQUZ0YzJkZmFYTmZaVzF3ZEhsZkJ0c3c0Q0xUSHpRajB6ODFJQmNCZG82QTJJNHYvdjRCYldGcGJsOWxlSFJsY201aGJESWtJbFZ4WHdqeFFBSCsvZ0Z0WVdsdVgyVjRkR1Z5Ym1Gc00xOEkyekRnZ0h6eThGOElHQUgrL3ZzQmNtVndiR0Y1WDNCeWIzUndjSER0Uk5BZzlBUXlOQ0NCQUlEWFJab2cwejh5TXlEVFB6SXlsb0lJRzNkQU11SWlKYmtsK0NPQkEraW9KS0M1c0k0cHlDUUI5QUFsendzL0lzOExQeUhQRmlESjdWVCsvQUZ5WlhCc1lYbGZjSEp2ZERKL0JsOEcyekRnL3Z3QmNtVndiR0Y1WDNCeWIzUXpjQVZmQlJrQUJOc3dBZ0VnSGhzQ0FuTWRIQUFQdEQ5eEE1aHRtRUFBdzdRYVp1ejJvN2VJdDRoQU1uYWp0NGxBSUhvSFNlbi82TWk0Y1YxNWNESjhBSGdRYWIvcEFCaDRFWDkrQUxnNnViUTRNakdidWpleG1uYWlhSG9BNUhhanQ0a0ErZ0FRNTRzUVpQYXFmMzZBdURxNXREZ3lNWnU2TjdHYUdDK0JiWmhBQWdGSUloOEJDYmlKQUNkUUlBSCsvdjBCWTI5dWMzUnlYM0J5YjNSZk1IQndnZ2diZDBEdFJOQWc5QVF5TkNDQkFJRFhSWTRVSU5JL01qTWcwajh5TWlCeDEwV1VnSHZ5OE43ZXlDUUI5QUFqendzL0lzOExQM0hQUVNIUEZpREo3VlQrL1FGamIyNXpkSEpmY0hKdmRGOHhYd1g0QUREd0lmNzhBWEIxYzJod1pHTTNkRzlqTk8xRTBQUUJ5Q0VBUk8xSGJ4SUI5QUFoenhZZ3llMVUvdjBCY0hWemFIQmtZemQwYjJNME1GOEMyekFCNHR6Ky9RRnRZV2x1WDJsdWRHVnlibUZzSVk1Wi92d0JaMlYwWDNOeVkxOWhaR1J5SU5BZzB3QXljTDJPR3Y3OUFXZGxkRjl6Y21OZllXUmtjakJ3eU1uUVZSRmZBdHN3NENCeTF5RXhJTk1BTWlINlFEUCsvUUZuWlhSZmMzSmpYMkZrWkhJeElTRlZNVjhFMnpEWUpDRndJd0hxampqKytRRnpkRzl5WlY5emFXZHZBQ0Z2akNKdmpDTnZqTzFISVcrTTdVVFE5QVZ2akNEdFYvNzlBWE4wYjNKbFgzTnBaMTlsYm1SZkJkZ2l4d0NPSENGd3VvNFNJb0lRWEg3aUIxVlJYd2J4UUFGZkJ0c3c0RjhHMnpEZy92NEJiV0ZwYmw5cGJuUmxjbTVoYkRFaTB4ODBJbkc2SkFBMm5pQ0FJMVZoWHdmeFFBRmZCOXN3NENNaFZXRmZCL0ZBQVY4SCcsXG4gICAgfTtcblxuICAgIHN0YXRpYyBhc3luYyByZXNvbHZlR2l2ZXJQYXJhbWV0ZXJzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBUT05DbGllbnROb2RlSnMuY3JlYXRlKHsgc2VydmVyczogWyduZXQudG9uLmRldiddIH0pO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbGV0IGtleXNQYXRoID0gcGF0aC5yZXNvbHZlKG9zLmhvbWVkaXIoKSwgJ2dpdmVyS2V5cy5qc29uJyk7XG4gICAgICAgICAgICBOZXR3b3JrVHJhY2VyLmdpdmVyS2V5cyA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKGtleXNQYXRoLCAndXRmOCcpKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgfVxuICAgICAgICBOZXR3b3JrVHJhY2VyLmdpdmVyQWRkcmVzcyA9IChhd2FpdCBjbGllbnQuY29udHJhY3RzLmNyZWF0ZURlcGxveU1lc3NhZ2Uoe1xuICAgICAgICAgICAgcGFja2FnZTogTmV0d29ya1RyYWNlci5naXZlclBhY2thZ2UsXG4gICAgICAgICAgICBjb25zdHJ1Y3RvclBhcmFtczoge30sXG4gICAgICAgICAgICBrZXlQYWlyOiBOZXR3b3JrVHJhY2VyLmdpdmVyS2V5cyxcbiAgICAgICAgfSkpLmFkZHJlc3M7XG4gICAgfVxuXG5cbn1cblxuIl19