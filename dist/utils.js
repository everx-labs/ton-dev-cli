"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.showUsage = showUsage;
exports.run = run;
exports.versionToNumber = versionToNumber;
exports.forceRmDir = forceRmDir;
exports.ensureCleanDirectory = ensureCleanDirectory;
exports.argsToOptions = argsToOptions;
exports.bindPathJoinTo = bindPathJoinTo;
exports.inputLine = inputLine;
exports.breakWords = breakWords;
exports.version = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

/*
 * Copyright 2018-2019 TON DEV SOLUTIONS LTD.
 *
 * Licensed under the SOFTWARE EVALUATION License (the "License"); you may not use
 * this file except in compliance with the License.  You may obtain a copy of the
 * License at: https://www.ton.dev/licenses
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific TON DEV software governing permissions and
 * limitations under the License.
 *
 */
var fs = require('fs');

var path = require('path');

var _require = require('child_process'),
    spawn = _require.spawn;

var version = JSON.parse(fs.readFileSync(path.join(__dirname, '../package.json')).toString()).version;
exports.version = version;
var root = process.cwd();

function showUsage(usage) {
  console.log("TON Labs Dev Tools ".concat(version));
  console.log(usage);
}

var spawnEnv = _objectSpread({}, process.env);

function run(name) {
  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    args[_key - 1] = arguments[_key];
  }

  return new Promise(function (resolve, reject) {
    try {
      var spawned = spawn(name, args, {
        env: spawnEnv
      });
      var errors = [];
      var output = [];
      spawned.stdout.on('data', function (data) {
        output.push(data.toString());
      });
      spawned.stderr.on('data', function (data) {
        errors.push(data.toString());
      });
      spawned.on('error', function (err) {
        reject(err);
      });
      spawned.on('close', function (code) {
        if (code === 0) {
          resolve(output.join(''));
        } else {
          reject(errors.join(''));
        }
      });
    } catch (error) {
      reject(error);
    }
  });
}

function versionToNumber(s) {
  var parts = "".concat(s || '').split('.').map(function (x) {
    return Number.parseInt(x);
  }).slice(0, 3);

  while (parts.length < 3) {
    parts.push(0);
  }

  return parts[0] * 1000000 + parts[1] * 1000 + parts[2];
}

function forceRmDir(dir) {
  fs.readdirSync(dir).forEach(function (item) {
    var itemPath = path.join(dir, item);
    var stat = fs.statSync(itemPath);

    if (itemPath === "." || itemPath === "..") {} else if (stat.isDirectory()) {
      forceRmDir(itemPath);
    } else {
      fs.unlinkSync(itemPath);
    }
  });
  fs.rmdirSync(dir);
}

function ensureCleanDirectory(path) {
  if (fs.existsSync(path)) {
    forceRmDir(path);
  }

  fs.mkdirSync(path, {
    recursive: true
  });
}

function findOptionName(arg, types) {
  if (arg.startsWith('--')) {
    var name = arg.substr(2);
    var optionName = Object.keys(types).find(function (x) {
      return x.toLowerCase() === name.toLowerCase();
    });

    if (!optionName) {
      throw "Invalid option: ".concat(arg);
    }

    return optionName;
  }

  if (arg.startsWith('-')) {
    var _name = arg.substr(1);

    var optionEntry = Object.entries(types).find(function (_ref) {
      var _ref2 = (0, _slicedToArray2["default"])(_ref, 2),
          _ = _ref2[0],
          _type = _ref2[1];

      var type = _type;
      return "".concat(type["short"] || '').toLowerCase() === _name.toLowerCase();
    });

    if (!optionEntry) {
      throw "Invalid option: ".concat(arg);
    }

    return optionEntry[0];
  }

  return null;
}

function argsToOptions(args, types) {
  var options = {
    files: []
  };
  Object.entries(types).forEach(function (_ref3) {
    var _ref4 = (0, _slicedToArray2["default"])(_ref3, 2),
        name = _ref4[0],
        _type = _ref4[1];

    var type = _type;

    if ((type.valueCount || 0) > 1) {
      options[name] = [];
    } else {
      options[name] = type.def;
    }
  });
  var pendingOption = null;
  args.forEach(function (arg) {
    if (pendingOption) {
      var type = types[pendingOption];

      if ((type.valueCount || 0) > 1) {
        options[pendingOption].push(arg);
      } else {
        options[pendingOption] = arg;
      }

      pendingOption = null;
    } else {
      var optionName = findOptionName(arg, types);

      if (optionName) {
        var _type2 = types[optionName];

        if ((_type2.valueCount || 0) > 0) {
          pendingOption = optionName;
        } else {
          options[optionName] = true;
        }
      } else {
        options.files.push(arg);
      }
    }
  });
  return options;
}

function bindPathJoinTo(base, separator) {
  if (separator) {
    var join = function join(base, item) {
      var baseWithSep = base.endsWith(separator);
      var itemWithSep = item.startsWith(separator);

      if (baseWithSep && itemWithSep) {
        return "".concat(base).concat(item.substr(1));
      }

      if (!baseWithSep && !itemWithSep) {
        return "".concat(base, "/").concat(item);
      }

      return "".concat(base).concat(item);
    };

    return function () {
      var path = base;

      for (var _len2 = arguments.length, items = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
        items[_key2] = arguments[_key2];
      }

      items.forEach(function (x) {
        return path = join(path, x);
      });
      return path;
    };
  }

  return function () {
    for (var _len3 = arguments.length, items = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
      items[_key3] = arguments[_key3];
    }

    return items.length > 0 ? path.join.apply(path, [base].concat(items)) : base;
  };
}

function inputLine() {
  return new Promise(function (resolve) {
    var standard_input = process.stdin;
    standard_input.setEncoding('utf-8');
    standard_input.once('data', function (data) {
      resolve("".concat(data).trim());
    });
  });
}

function breakWords(s) {
  var words = s.split(' ');
  var result = '';
  var line = '';
  words.forEach(function (w) {
    if (line.length + w.length > 80) {
      if (result !== '') {
        result += '\n';
      }

      result += line;
      line = '';
    }

    if (line !== '') {
      line += ' ';
    }

    line += w;
  });

  if (line !== '') {
    if (result !== '') {
      result += '\n';
    }

    result += line;
  }

  return result;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91dGlscy5qcyJdLCJuYW1lcyI6WyJmcyIsInJlcXVpcmUiLCJwYXRoIiwic3Bhd24iLCJ2ZXJzaW9uIiwiSlNPTiIsInBhcnNlIiwicmVhZEZpbGVTeW5jIiwiam9pbiIsIl9fZGlybmFtZSIsInRvU3RyaW5nIiwicm9vdCIsInByb2Nlc3MiLCJjd2QiLCJzaG93VXNhZ2UiLCJ1c2FnZSIsImNvbnNvbGUiLCJsb2ciLCJzcGF3bkVudiIsImVudiIsInJ1biIsIm5hbWUiLCJhcmdzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJzcGF3bmVkIiwiZXJyb3JzIiwib3V0cHV0Iiwic3Rkb3V0Iiwib24iLCJkYXRhIiwicHVzaCIsInN0ZGVyciIsImVyciIsImNvZGUiLCJlcnJvciIsInZlcnNpb25Ub051bWJlciIsInMiLCJwYXJ0cyIsInNwbGl0IiwibWFwIiwieCIsIk51bWJlciIsInBhcnNlSW50Iiwic2xpY2UiLCJsZW5ndGgiLCJmb3JjZVJtRGlyIiwiZGlyIiwicmVhZGRpclN5bmMiLCJmb3JFYWNoIiwiaXRlbSIsIml0ZW1QYXRoIiwic3RhdCIsInN0YXRTeW5jIiwiaXNEaXJlY3RvcnkiLCJ1bmxpbmtTeW5jIiwicm1kaXJTeW5jIiwiZW5zdXJlQ2xlYW5EaXJlY3RvcnkiLCJleGlzdHNTeW5jIiwibWtkaXJTeW5jIiwicmVjdXJzaXZlIiwiZmluZE9wdGlvbk5hbWUiLCJhcmciLCJ0eXBlcyIsInN0YXJ0c1dpdGgiLCJzdWJzdHIiLCJvcHRpb25OYW1lIiwiT2JqZWN0Iiwia2V5cyIsImZpbmQiLCJ0b0xvd2VyQ2FzZSIsIm9wdGlvbkVudHJ5IiwiZW50cmllcyIsIl8iLCJfdHlwZSIsInR5cGUiLCJhcmdzVG9PcHRpb25zIiwib3B0aW9ucyIsImZpbGVzIiwidmFsdWVDb3VudCIsImRlZiIsInBlbmRpbmdPcHRpb24iLCJiaW5kUGF0aEpvaW5UbyIsImJhc2UiLCJzZXBhcmF0b3IiLCJiYXNlV2l0aFNlcCIsImVuZHNXaXRoIiwiaXRlbVdpdGhTZXAiLCJpdGVtcyIsImlucHV0TGluZSIsInN0YW5kYXJkX2lucHV0Iiwic3RkaW4iLCJzZXRFbmNvZGluZyIsIm9uY2UiLCJ0cmltIiwiYnJlYWtXb3JkcyIsIndvcmRzIiwicmVzdWx0IiwibGluZSIsInciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7Ozs7O0FBZUEsSUFBTUEsRUFBRSxHQUFHQyxPQUFPLENBQUMsSUFBRCxDQUFsQjs7QUFDQSxJQUFNQyxJQUFJLEdBQUdELE9BQU8sQ0FBQyxNQUFELENBQXBCOztlQUNrQkEsT0FBTyxDQUFDLGVBQUQsQztJQUFqQkUsSyxZQUFBQSxLOztBQUVSLElBQU1DLE9BQU8sR0FBR0MsSUFBSSxDQUFDQyxLQUFMLENBQVdOLEVBQUUsQ0FBQ08sWUFBSCxDQUFnQkwsSUFBSSxDQUFDTSxJQUFMLENBQVVDLFNBQVYsRUFBcUIsaUJBQXJCLENBQWhCLEVBQXlEQyxRQUF6RCxFQUFYLEVBQWdGTixPQUFoRzs7QUFDQSxJQUFNTyxJQUFJLEdBQUdDLE9BQU8sQ0FBQ0MsR0FBUixFQUFiOztBQUVBLFNBQVNDLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQWtDO0FBQzlCQyxFQUFBQSxPQUFPLENBQUNDLEdBQVIsOEJBQWtDYixPQUFsQztBQUNBWSxFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUYsS0FBWjtBQUNIOztBQUVELElBQU1HLFFBQVEscUJBQ1BOLE9BQU8sQ0FBQ08sR0FERCxDQUFkOztBQUlBLFNBQVNDLEdBQVQsQ0FBYUMsSUFBYixFQUErRDtBQUFBLG9DQUFqQ0MsSUFBaUM7QUFBakNBLElBQUFBLElBQWlDO0FBQUE7O0FBQzNELFNBQU8sSUFBSUMsT0FBSixDQUFZLFVBQUNDLE9BQUQsRUFBVUMsTUFBVixFQUFxQjtBQUNwQyxRQUFJO0FBQ0EsVUFBTUMsT0FBTyxHQUFHdkIsS0FBSyxDQUFDa0IsSUFBRCxFQUFPQyxJQUFQLEVBQWE7QUFBRUgsUUFBQUEsR0FBRyxFQUFFRDtBQUFQ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QixRQUFJRCxJQUFJLENBQUNyRCxNQUFMLEdBQWNzRCxDQUFDLENBQUN0RCxNQUFoQixHQUF5QixFQUE3QixFQUFpQztBQUM3QixVQUFJb0QsTUFBTSxLQUFLLEVBQWYsRUFBbUI7QUFDZkEsUUFBQUEsTUFBTSxJQUFJLElBQVY7QUFDSDs7QUFDREEsTUFBQUEsTUFBTSxJQUFJQyxJQUFWO0FBQ0FBLE1BQUFBLElBQUksR0FBRyxFQUFQO0FBQ0g7O0FBQ0QsUUFBSUEsSUFBSSxLQUFLLEVBQWIsRUFBaUI7QUFDYkEsTUFBQUEsSUFBSSxJQUFJLEdBQVI7QUFDSDs7QUFDREEsSUFBQUEsSUFBSSxJQUFJQyxDQUFSO0FBQ0gsR0FaRDs7QUFhQSxNQUFJRCxJQUFJLEtBQUssRUFBYixFQUFpQjtBQUNiLFFBQUlELE1BQU0sS0FBSyxFQUFmLEVBQW1CO0FBQ2ZBLE1BQUFBLE1BQU0sSUFBSSxJQUFWO0FBQ0g7O0FBQ0RBLElBQUFBLE1BQU0sSUFBSUMsSUFBVjtBQUNIOztBQUNELFNBQU9ELE1BQVA7QUFDSCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAxOC0yMDE5IFRPTiBERVYgU09MVVRJT05TIExURC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgU09GVFdBUkUgRVZBTFVBVElPTiBMaWNlbnNlICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2VcbiAqIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZVxuICogTGljZW5zZSBhdDogaHR0cHM6Ly93d3cudG9uLmRldi9saWNlbnNlc1xuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgVE9OIERFViBzb2Z0d2FyZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqXG4gKi9cbi8vIEBmbG93XG5jb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QgeyBzcGF3biB9ID0gcmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpO1xuXG5jb25zdCB2ZXJzaW9uID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL3BhY2thZ2UuanNvbicpKS50b1N0cmluZygpKS52ZXJzaW9uO1xuY29uc3Qgcm9vdCA9IHByb2Nlc3MuY3dkKCk7XG5cbmZ1bmN0aW9uIHNob3dVc2FnZSh1c2FnZTogc3RyaW5nKSB7XG4gICAgY29uc29sZS5sb2coYFRPTiBMYWJzIERldiBUb29scyAke3ZlcnNpb259YCk7XG4gICAgY29uc29sZS5sb2codXNhZ2UpO1xufVxuXG5jb25zdCBzcGF3bkVudiA9IHtcbiAgICAuLi5wcm9jZXNzLmVudixcbn07XG5cbmZ1bmN0aW9uIHJ1bihuYW1lOiBzdHJpbmcsIC4uLmFyZ3M6IHN0cmluZ1tdKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3Qgc3Bhd25lZCA9IHNwYXduKG5hbWUsIGFyZ3MsIHsgZW52OiBzcGF3bkVudiB9KTtcbiAgICAgICAgICAgIGNvbnN0IGVycm9ycyA9IFtdO1xuICAgICAgICAgICAgY29uc3Qgb3V0cHV0ID0gW107XG5cbiAgICAgICAgICAgIHNwYXduZWQuc3Rkb3V0Lm9uKCdkYXRhJywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBvdXRwdXQucHVzaChkYXRhLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNwYXduZWQuc3RkZXJyLm9uKCdkYXRhJywgKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICBlcnJvcnMucHVzaChkYXRhLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNwYXduZWQub24oJ2Vycm9yJywgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNwYXduZWQub24oJ2Nsb3NlJywgKGNvZGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY29kZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG91dHB1dC5qb2luKCcnKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9ycy5qb2luKCcnKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHZlcnNpb25Ub051bWJlcihzOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGNvbnN0IHBhcnRzID0gYCR7cyB8fCAnJ31gLnNwbGl0KCcuJykubWFwKHggPT4gTnVtYmVyLnBhcnNlSW50KHgpKS5zbGljZSgwLCAzKTtcbiAgICB3aGlsZSAocGFydHMubGVuZ3RoIDwgMykge1xuICAgICAgICBwYXJ0cy5wdXNoKDApO1xuICAgIH1cbiAgICByZXR1cm4gcGFydHNbMF0gKiAxMDAwMDAwICsgcGFydHNbMV0gKiAxMDAwICsgcGFydHNbMl07XG59XG5cbmZ1bmN0aW9uIGZvcmNlUm1EaXIoZGlyOiBzdHJpbmcpIHtcbiAgICBmcy5yZWFkZGlyU3luYyhkaXIpLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgY29uc3QgaXRlbVBhdGggPSBwYXRoLmpvaW4oZGlyLCBpdGVtKTtcbiAgICAgICAgY29uc3Qgc3RhdCA9IGZzLnN0YXRTeW5jKGl0ZW1QYXRoKTtcblxuICAgICAgICBpZiAoaXRlbVBhdGggPT09IFwiLlwiIHx8IGl0ZW1QYXRoID09PSBcIi4uXCIpIHtcbiAgICAgICAgfSBlbHNlIGlmIChzdGF0LmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgICAgIGZvcmNlUm1EaXIoaXRlbVBhdGgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZnMudW5saW5rU3luYyhpdGVtUGF0aCk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBmcy5ybWRpclN5bmMoZGlyKTtcbn1cblxuZnVuY3Rpb24gZW5zdXJlQ2xlYW5EaXJlY3RvcnkocGF0aDogc3RyaW5nKSB7XG4gICAgaWYgKGZzLmV4aXN0c1N5bmMocGF0aCkpIHtcbiAgICAgICAgZm9yY2VSbURpcihwYXRoKTtcbiAgICB9XG4gICAgZnMubWtkaXJTeW5jKHBhdGgsICh7IHJlY3Vyc2l2ZTogdHJ1ZSB9OiBhbnkpKTtcbn1cblxuXG5leHBvcnQgdHlwZSBBcmdUeXBlID0ge1xuICAgIGRlZjogYW55LFxuICAgIHNob3J0Pzogc3RyaW5nLFxuICAgIHZhbHVlQ291bnQ/OiBudW1iZXIsXG59XG5cbmV4cG9ydCB0eXBlIEFyZ1R5cGVzID0ge1xuICAgIFtzdHJpbmddOiBBcmdUeXBlXG59XG5cbmZ1bmN0aW9uIGZpbmRPcHRpb25OYW1lKGFyZzogc3RyaW5nLCB0eXBlczogQXJnVHlwZXMpIHtcbiAgICBpZiAoYXJnLnN0YXJ0c1dpdGgoJy0tJykpIHtcbiAgICAgICAgY29uc3QgbmFtZSA9IGFyZy5zdWJzdHIoMik7XG4gICAgICAgIGNvbnN0IG9wdGlvbk5hbWUgPSBPYmplY3Qua2V5cyh0eXBlcykuZmluZCh4ID0+IHgudG9Mb3dlckNhc2UoKSA9PT0gbmFtZS50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgaWYgKCFvcHRpb25OYW1lKSB7XG4gICAgICAgICAgICB0aHJvdyBgSW52YWxpZCBvcHRpb246ICR7YXJnfWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9wdGlvbk5hbWU7XG4gICAgfVxuICAgIGlmIChhcmcuc3RhcnRzV2l0aCgnLScpKSB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBhcmcuc3Vic3RyKDEpO1xuICAgICAgICBjb25zdCBvcHRpb25FbnRyeSA9IE9iamVjdC5lbnRyaWVzKHR5cGVzKS5maW5kKChbXywgX3R5cGVdKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0eXBlOiBBcmdUeXBlID0gKF90eXBlOiBhbnkpO1xuICAgICAgICAgICAgcmV0dXJuIGAke3R5cGUuc2hvcnQgfHwgJyd9YC50b0xvd2VyQ2FzZSgpID09PSBuYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIW9wdGlvbkVudHJ5KSB7XG4gICAgICAgICAgICB0aHJvdyBgSW52YWxpZCBvcHRpb246ICR7YXJnfWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG9wdGlvbkVudHJ5WzBdO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cblxuXG5mdW5jdGlvbiBhcmdzVG9PcHRpb25zKGFyZ3M6IHN0cmluZ1tdLCB0eXBlczogeyBbc3RyaW5nXTogQXJnVHlwZSB9KTogYW55IHtcbiAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICBmaWxlczogW10sXG4gICAgfTtcbiAgICBPYmplY3QuZW50cmllcyh0eXBlcykuZm9yRWFjaCgoW25hbWUsIF90eXBlXSkgPT4ge1xuICAgICAgICBjb25zdCB0eXBlOiBBcmdUeXBlID0gKF90eXBlOiBhbnkpO1xuICAgICAgICBpZiAoKHR5cGUudmFsdWVDb3VudCB8fCAwKSA+IDEpIHtcbiAgICAgICAgICAgIG9wdGlvbnNbbmFtZV0gPSBbXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG9wdGlvbnNbbmFtZV0gPSB0eXBlLmRlZjtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGxldCBwZW5kaW5nT3B0aW9uID0gbnVsbDtcbiAgICBhcmdzLmZvckVhY2goKGFyZykgPT4ge1xuICAgICAgICBpZiAocGVuZGluZ09wdGlvbikge1xuICAgICAgICAgICAgY29uc3QgdHlwZSA9IHR5cGVzW3BlbmRpbmdPcHRpb25dO1xuICAgICAgICAgICAgaWYgKCh0eXBlLnZhbHVlQ291bnQgfHwgMCkgPiAxKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9uc1twZW5kaW5nT3B0aW9uXS5wdXNoKGFyZyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG9wdGlvbnNbcGVuZGluZ09wdGlvbl0gPSBhcmc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwZW5kaW5nT3B0aW9uID0gbnVsbDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbk5hbWUgPSBmaW5kT3B0aW9uTmFtZShhcmcsIHR5cGVzKTtcbiAgICAgICAgICAgIGlmIChvcHRpb25OYW1lKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IHR5cGVzW29wdGlvbk5hbWVdO1xuICAgICAgICAgICAgICAgIGlmICgodHlwZS52YWx1ZUNvdW50IHx8IDApID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBwZW5kaW5nT3B0aW9uID0gb3B0aW9uTmFtZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zW29wdGlvbk5hbWVdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMuZmlsZXMucHVzaChhcmcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIG9wdGlvbnM7XG59XG5cbmV4cG9ydCB0eXBlIFBhdGhKb2luID0gKC4uLml0ZW1zOiBzdHJpbmdbXSkgPT4gc3RyaW5nO1xuXG5mdW5jdGlvbiBiaW5kUGF0aEpvaW5UbyhiYXNlOiBzdHJpbmcsIHNlcGFyYXRvcj86IHN0cmluZyk6IFBhdGhKb2luIHtcbiAgICBpZiAoc2VwYXJhdG9yKSB7XG4gICAgICAgIGZ1bmN0aW9uIGpvaW4oYmFzZTogc3RyaW5nLCBpdGVtOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICAgICAgY29uc3QgYmFzZVdpdGhTZXAgPSBiYXNlLmVuZHNXaXRoKHNlcGFyYXRvcik7XG4gICAgICAgICAgICBjb25zdCBpdGVtV2l0aFNlcCA9IGl0ZW0uc3RhcnRzV2l0aChzZXBhcmF0b3IpO1xuICAgICAgICAgICAgaWYgKGJhc2VXaXRoU2VwICYmIGl0ZW1XaXRoU2VwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke2Jhc2V9JHtpdGVtLnN1YnN0cigxKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFiYXNlV2l0aFNlcCAmJiAhaXRlbVdpdGhTZXApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7YmFzZX0vJHtpdGVtfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYCR7YmFzZX0ke2l0ZW19YDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKC4uLml0ZW1zOiBzdHJpbmdbXSk6IHN0cmluZyA9PiB7XG4gICAgICAgICAgICBsZXQgcGF0aCA9IGJhc2U7XG4gICAgICAgICAgICBpdGVtcy5mb3JFYWNoKHggPT4gcGF0aCA9IGpvaW4ocGF0aCwgeCkpO1xuICAgICAgICAgICAgcmV0dXJuIHBhdGg7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuICguLi5pdGVtczogc3RyaW5nW10pOiBzdHJpbmcgPT4ge1xuICAgICAgICByZXR1cm4gaXRlbXMubGVuZ3RoID4gMCA/IHBhdGguam9pbihiYXNlLCAuLi5pdGVtcykgOiBiYXNlO1xuICAgIH1cbn1cblxuXG5mdW5jdGlvbiBpbnB1dExpbmUoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgY29uc3Qgc3RhbmRhcmRfaW5wdXQgPSBwcm9jZXNzLnN0ZGluO1xuICAgICAgICBzdGFuZGFyZF9pbnB1dC5zZXRFbmNvZGluZygndXRmLTgnKTtcbiAgICAgICAgc3RhbmRhcmRfaW5wdXQub25jZSgnZGF0YScsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICByZXNvbHZlKGAke2RhdGF9YC50cmltKCkpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gYnJlYWtXb3JkcyhzOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHdvcmRzID0gcy5zcGxpdCgnICcpO1xuICAgIGxldCByZXN1bHQgPSAnJztcbiAgICBsZXQgbGluZSA9ICcnO1xuICAgIHdvcmRzLmZvckVhY2goKHcpID0+IHtcbiAgICAgICAgaWYgKGxpbmUubGVuZ3RoICsgdy5sZW5ndGggPiA4MCkge1xuICAgICAgICAgICAgaWYgKHJlc3VsdCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gJ1xcbic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHQgKz0gbGluZTtcbiAgICAgICAgICAgIGxpbmUgPSAnJztcbiAgICAgICAgfVxuICAgICAgICBpZiAobGluZSAhPT0gJycpIHtcbiAgICAgICAgICAgIGxpbmUgKz0gJyAnO1xuICAgICAgICB9XG4gICAgICAgIGxpbmUgKz0gdztcbiAgICB9KTtcbiAgICBpZiAobGluZSAhPT0gJycpIHtcbiAgICAgICAgaWYgKHJlc3VsdCAhPT0gJycpIHtcbiAgICAgICAgICAgIHJlc3VsdCArPSAnXFxuJztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQgKz0gbGluZTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cblxuXG5cbmV4cG9ydCB7XG4gICAgdmVyc2lvbixcbiAgICBzaG93VXNhZ2UsXG4gICAgcnVuLFxuICAgIHZlcnNpb25Ub051bWJlcixcbiAgICBmb3JjZVJtRGlyLFxuICAgIGVuc3VyZUNsZWFuRGlyZWN0b3J5LFxuICAgIGFyZ3NUb09wdGlvbnMsXG4gICAgYmluZFBhdGhKb2luVG8sXG4gICAgaW5wdXRMaW5lLFxuICAgIGJyZWFrV29yZHMsXG59XG4iXX0=