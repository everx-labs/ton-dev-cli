"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.showUsage = showUsage;
exports.run = run;
exports.versionToNumber = versionToNumber;
exports.forceRmDir = forceRmDir;
exports.ensureCleanDirectory = ensureCleanDirectory;
exports.bindPathJoinTo = bindPathJoinTo;
exports.inputLine = inputLine;
exports.breakWords = breakWords;
exports.httpsGetJson = httpsGetJson;
exports.toIdentifier = toIdentifier;
exports.progress = progress;
exports.progressDone = progressDone;
exports.parseFileArg = parseFileArg;
exports.tonlabsHomePath = exports.userIdentifier = exports.version = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _texts = require("./texts");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var fs = require('fs');

var os = require('os');

var path = require('path');

var _require = require('child_process'),
    spawn = _require.spawn;

var version = JSON.parse(fs.readFileSync(path.join(__dirname, '..', '..', 'package.json')).toString()).version;
exports.version = version;

function showUsage(usage) {
  console.log(_texts.texts.usageHeader(version));
  console.log(usage);
}

var spawnEnv = _objectSpread({}, process.env);

function run(name) {
  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    args[_key - 1] = arguments[_key];
  }

  return new Promise(function (resolve, reject) {
    try {
      var spawned = spawn(name, args, {
        env: spawnEnv
      });
      var errors = [];
      var output = [];
      spawned.stdout.on('data', function (data) {
        output.push(data.toString());
      });
      spawned.stderr.on('data', function (data) {
        errors.push(data.toString());
      });
      spawned.on('error', function (err) {
        reject(err);
      });
      spawned.on('close', function (code) {
        if (code === 0) {
          resolve(output.join(''));
        } else {
          reject(errors.join(''));
        }
      });
    } catch (error) {
      reject(error);
    }
  });
}

function versionToNumber(s) {
  var parts = "".concat(s || '').split('.').map(function (x) {
    return Number.parseInt(x);
  }).slice(0, 3);

  while (parts.length < 3) {
    parts.push(0);
  }

  return parts[0] * 1000000 + parts[1] * 1000 + parts[2];
}

function forceRmDir(dir) {
  fs.readdirSync(dir).forEach(function (item) {
    var itemPath = path.join(dir, item);
    var stat = fs.statSync(itemPath);

    if (itemPath === "." || itemPath === "..") {} else if (stat.isDirectory()) {
      forceRmDir(itemPath);
    } else {
      fs.unlinkSync(itemPath);
    }
  });
  fs.rmdirSync(dir);
}

function ensureCleanDirectory(path) {
  if (fs.existsSync(path)) {
    forceRmDir(path);
  }

  fs.mkdirSync(path, {
    recursive: true
  });
}

function join(base, item, separator) {
  var baseWithSep = base.endsWith(separator);
  var itemWithSep = item.startsWith(separator);

  if (baseWithSep && itemWithSep) {
    return "".concat(base).concat(item.substr(1));
  }

  if (!baseWithSep && !itemWithSep) {
    return "".concat(base, "/").concat(item);
  }

  return "".concat(base).concat(item);
}

function bindPathJoinTo(base, separator) {
  if (separator) {
    var sep = separator;
    return function () {
      var path = base;

      for (var _len2 = arguments.length, items = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
        items[_key2] = arguments[_key2];
      }

      items.forEach(function (x) {
        return path = join(path, x, sep);
      });
      return path;
    };
  }

  return function () {
    for (var _len3 = arguments.length, items = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
      items[_key3] = arguments[_key3];
    }

    return items.length > 0 ? path.join.apply(path, [base].concat(items)) : base;
  };
}

function inputLine() {
  return new Promise(function (resolve) {
    var standard_input = process.stdin;
    standard_input.setEncoding('utf-8');
    standard_input.once('data', function (data) {
      resolve("".concat(data).trim());
    });
  });
}

function breakWords(s) {
  var words = s.split(' ');
  var result = '';
  var line = '';
  words.forEach(function (w) {
    if (line.length + w.length > 80) {
      if (result !== '') {
        result += '\n';
      }

      result += line;
      line = '';
    }

    if (line !== '') {
      line += ' ';
    }

    line += w;
  });

  if (line !== '') {
    if (result !== '') {
      result += '\n';
    }

    result += line;
  }

  return result;
}

var https = require('https');

function httpsGetJson(url) {
  return new Promise(function (resolve, reject) {
    var tryUrl = function tryUrl(url) {
      https.get(url, function (res) {
        var body = '';
        res.on('data', function (chunk) {
          body += chunk;
        });
        res.on('end', function () {
          if (res.statusCode === 301) {
            var redirectUrl = res.headers['location'];
            tryUrl(redirectUrl);
            return;
          }

          var response = JSON.parse(body);
          resolve(response);
        });
      }).on('error', function (error) {
        reject(error);
      });
    };

    tryUrl(url);
  });
}

function toIdentifier(s) {
  var identifier = '';

  for (var i = 0; i < s.length; i += 1) {
    var c = s[i];
    var isLetter = c.toLowerCase() !== c.toUpperCase();
    var isDigit = !isLetter && '0123456789'.includes(c);

    if (isLetter || isDigit) {
      identifier += c;
    }
  }

  return identifier;
}

var userIdentifier = toIdentifier(os.userInfo().username).toLowerCase();
exports.userIdentifier = userIdentifier;
var tonlabsHomePath = bindPathJoinTo(path.join(os.homedir(), '.tonlabs'));
exports.tonlabsHomePath = tonlabsHomePath;

function progress(info) {
  process.stdout.write("".concat(info, "..."));
}

function progressDone() {
  console.log(' âœ“');
}

function parseFileArg(fileArg, ext) {
  if (os.platform() === 'darwin' && fileArg.startsWith('~/')) {
    fileArg = path.join(os.homedir(), fileArg.substr(2));
  }

  var filePath = path.resolve(fileArg);
  var dir = bindPathJoinTo(path.dirname(filePath));
  var base = path.basename(filePath, ext);
  var name = base.includes('.') ? base : "".concat(base).concat(ext);
  var result = {
    dir: dir,
    base: base,
    name: name
  };

  if (!fs.existsSync(result.dir(name))) {
    console.error(_texts.texts.sourceFileNotFound(name));
    process.exit(1);
  }

  return result;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy91dGlscy5qcyJdLCJuYW1lcyI6WyJmcyIsInJlcXVpcmUiLCJvcyIsInBhdGgiLCJzcGF3biIsInZlcnNpb24iLCJKU09OIiwicGFyc2UiLCJyZWFkRmlsZVN5bmMiLCJqb2luIiwiX19kaXJuYW1lIiwidG9TdHJpbmciLCJzaG93VXNhZ2UiLCJ1c2FnZSIsImNvbnNvbGUiLCJsb2ciLCJ0ZXh0cyIsInVzYWdlSGVhZGVyIiwic3Bhd25FbnYiLCJwcm9jZXNzIiwiZW52IiwicnVuIiwibmFtZSIsImFyZ3MiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInNwYXduZWQiLCJlcnJvcnMiLCJvdXRwdXQiLCJzdGRvdXQiLCJvbiIsImRhdGEiLCJwdXNoIiwic3RkZXJyIiwiZXJyIiwiY29kZSIsImVycm9yIiwidmVyc2lvblRvTnVtYmVyIiwicyIsInBhcnRzIiwic3BsaXQiLCJtYXAiLCJ4IiwiTnVtYmVyIiwicGFyc2VJbnQiLCJzbGljZSIsImxlbmd0aCIsImZvcmNlUm1EaXIiLCJkaXIiLCJyZWFkZGlyU3luYyIsImZvckVhY2giLCJpdGVtIiwiaXRlbVBhdGgiLCJzdGF0Iiwic3RhdFN5bmMiLCJpc0RpcmVjdG9yeSIsInVubGlua1N5bmMiLCJybWRpclN5bmMiLCJlbnN1cmVDbGVhbkRpcmVjdG9yeSIsImV4aXN0c1N5bmMiLCJta2RpclN5bmMiLCJyZWN1cnNpdmUiLCJiYXNlIiwic2VwYXJhdG9yIiwiYmFzZVdpdGhTZXAiLCJlbmRzV2l0aCIsIml0ZW1XaXRoU2VwIiwic3RhcnRzV2l0aCIsInN1YnN0ciIsImJpbmRQYXRoSm9pblRvIiwic2VwIiwiaXRlbXMiLCJpbnB1dExpbmUiLCJzdGFuZGFyZF9pbnB1dCIsInN0ZGluIiwic2V0RW5jb2RpbmciLCJvbmNlIiwidHJpbSIsImJyZWFrV29yZHMiLCJ3b3JkcyIsInJlc3VsdCIsImxpbmUiLCJ3IiwiaHR0cHMiLCJodHRwc0dldEpzb24iLCJ1cmwiLCJ0cnlVcmwiLCJnZXQiLCJyZXMiLCJib2R5IiwiY2h1bmsiLCJzdGF0dXNDb2RlIiwicmVkaXJlY3RVcmwiLCJoZWFkZXJzIiwicmVzcG9uc2UiLCJ0b0lkZW50aWZpZXIiLCJpZGVudGlmaWVyIiwiaSIsImMiLCJpc0xldHRlciIsInRvTG93ZXJDYXNlIiwidG9VcHBlckNhc2UiLCJpc0RpZ2l0IiwiaW5jbHVkZXMiLCJ1c2VySWRlbnRpZmllciIsInVzZXJJbmZvIiwidXNlcm5hbWUiLCJ0b25sYWJzSG9tZVBhdGgiLCJob21lZGlyIiwicHJvZ3Jlc3MiLCJpbmZvIiwid3JpdGUiLCJwcm9ncmVzc0RvbmUiLCJwYXJzZUZpbGVBcmciLCJmaWxlQXJnIiwiZXh0IiwicGxhdGZvcm0iLCJmaWxlUGF0aCIsImRpcm5hbWUiLCJiYXNlbmFtZSIsInNvdXJjZUZpbGVOb3RGb3VuZCIsImV4aXQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWVBOzs7Ozs7QUFFQSxJQUFNQSxFQUFFLEdBQUdDLE9BQU8sQ0FBQyxJQUFELENBQWxCOztBQUNBLElBQU1DLEVBQUUsR0FBR0QsT0FBTyxDQUFDLElBQUQsQ0FBbEI7O0FBQ0EsSUFBTUUsSUFBSSxHQUFHRixPQUFPLENBQUMsTUFBRCxDQUFwQjs7ZUFDa0JBLE9BQU8sQ0FBQyxlQUFELEM7SUFBakJHLEssWUFBQUEsSzs7QUFDUixJQUFNQyxPQUFPLEdBQUdDLElBQUksQ0FBQ0MsS0FBTCxDQUFXUCxFQUFFLENBQUNRLFlBQUgsQ0FBZ0JMLElBQUksQ0FBQ00sSUFBTCxDQUFVQyxTQUFWLEVBQXFCLElBQXJCLEVBQTJCLElBQTNCLEVBQWlDLGNBQWpDLENBQWhCLEVBQWtFQyxRQUFsRSxFQUFYLEVBQXlGTixPQUF6Rzs7O0FBRUEsU0FBU08sU0FBVCxDQUFtQkMsS0FBbkIsRUFBa0M7QUFDOUJDLEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxhQUFNQyxXQUFOLENBQWtCWixPQUFsQixDQUFaO0FBQ0FTLEVBQUFBLE9BQU8sQ0FBQ0MsR0FB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Q3FELEdBQXRDLENBQWI7QUFDQSxNQUFNbkMsTUFBTSxHQUFHO0FBQ1hoQyxJQUFBQSxHQUFHLEVBQUhBLEdBRFc7QUFFWGMsSUFBQUEsSUFBSSxFQUFKQSxJQUZXO0FBR1h6QyxJQUFBQSxJQUFJLEVBQUpBO0FBSFcsR0FBZjs7QUFLQSxNQUFJLENBQUN0QixFQUFFLENBQUM0RCxVQUFILENBQWNxQixNQUFNLENBQUNoQyxHQUFQLENBQVczQixJQUFYLENBQWQsQ0FBTCxFQUFzQztBQUNsQ1IsSUFBQUEsT0FBTyxDQUFDdUIsS0FBUixDQUFjckIsYUFBTXlHLGtCQUFOLENBQXlCbkcsSUFBekIsQ0FBZDtBQUNBSCxJQUFBQSxPQUFPLENBQUN1RyxJQUFSLENBQWEsQ0FBYjtBQUNIOztBQUNELFNBQU96QyxNQUFQO0FBQ0giLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMTgtMjAxOSBUT04gREVWIFNPTFVUSU9OUyBMVEQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIFNPRlRXQVJFIEVWQUxVQVRJT04gTGljZW5zZSAodGhlIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlXG4gKiB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGVcbiAqIExpY2Vuc2UgYXQ6IGh0dHBzOi8vd3d3LnRvbi5kZXYvbGljZW5zZXNcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIFRPTiBERVYgc29mdHdhcmUgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKlxuICovXG4vLyBAZmxvd1xuaW1wb3J0IHsgdGV4dHMgfSBmcm9tICcuL3RleHRzJztcblxuY29uc3QgZnMgPSByZXF1aXJlKCdmcycpO1xuY29uc3Qgb3MgPSByZXF1aXJlKCdvcycpO1xuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmNvbnN0IHsgc3Bhd24gfSA9IHJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKTtcbmNvbnN0IHZlcnNpb24gPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAncGFja2FnZS5qc29uJykpLnRvU3RyaW5nKCkpLnZlcnNpb247XG5cbmZ1bmN0aW9uIHNob3dVc2FnZSh1c2FnZTogc3RyaW5nKSB7XG4gICAgY29uc29sZS5sb2codGV4dHMudXNhZ2VIZWFkZXIodmVyc2lvbikpO1xuICAgIGNvbnNvbGUubG9nKHVzYWdlKTtcbn1cblxuY29uc3Qgc3Bhd25FbnYgPSB7XG4gICAgLi4ucHJvY2Vzcy5lbnYsXG59O1xuXG5mdW5jdGlvbiBydW4obmFtZTogc3RyaW5nLCAuLi5hcmdzOiBzdHJpbmdbXSk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHNwYXduZWQgPSBzcGF3bihuYW1lLCBhcmdzLCB7IGVudjogc3Bhd25FbnYgfSk7XG4gICAgICAgICAgICBjb25zdCBlcnJvcnMgPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IG91dHB1dCA9IFtdO1xuXG4gICAgICAgICAgICBzcGF3bmVkLnN0ZG91dC5vbignZGF0YScsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0LnB1c2goZGF0YS50b1N0cmluZygpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzcGF3bmVkLnN0ZGVyci5vbignZGF0YScsIChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgZXJyb3JzLnB1c2goZGF0YS50b1N0cmluZygpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzcGF3bmVkLm9uKCdlcnJvcicsIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzcGF3bmVkLm9uKCdjbG9zZScsIChjb2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNvZGUgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvdXRwdXQuam9pbignJykpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcnMuam9pbignJykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG5mdW5jdGlvbiB2ZXJzaW9uVG9OdW1iZXIoczogc3RyaW5nKTogbnVtYmVyIHtcbiAgICBjb25zdCBwYXJ0cyA9IGAke3MgfHwgJyd9YC5zcGxpdCgnLicpLm1hcCh4ID0+IE51bWJlci5wYXJzZUludCh4KSkuc2xpY2UoMCwgMyk7XG4gICAgd2hpbGUgKHBhcnRzLmxlbmd0aCA8IDMpIHtcbiAgICAgICAgcGFydHMucHVzaCgwKTtcbiAgICB9XG4gICAgcmV0dXJuIHBhcnRzWzBdICogMTAwMDAwMCArIHBhcnRzWzFdICogMTAwMCArIHBhcnRzWzJdO1xufVxuXG5mdW5jdGlvbiBmb3JjZVJtRGlyKGRpcjogc3RyaW5nKSB7XG4gICAgZnMucmVhZGRpclN5bmMoZGlyKS5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgIGNvbnN0IGl0ZW1QYXRoID0gcGF0aC5qb2luKGRpciwgaXRlbSk7XG4gICAgICAgIGNvbnN0IHN0YXQgPSBmcy5zdGF0U3luYyhpdGVtUGF0aCk7XG5cbiAgICAgICAgaWYgKGl0ZW1QYXRoID09PSBcIi5cIiB8fCBpdGVtUGF0aCA9PT0gXCIuLlwiKSB7XG4gICAgICAgIH0gZWxzZSBpZiAoc3RhdC5pc0RpcmVjdG9yeSgpKSB7XG4gICAgICAgICAgICBmb3JjZVJtRGlyKGl0ZW1QYXRoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZzLnVubGlua1N5bmMoaXRlbVBhdGgpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgZnMucm1kaXJTeW5jKGRpcik7XG59XG5cbmZ1bmN0aW9uIGVuc3VyZUNsZWFuRGlyZWN0b3J5KHBhdGg6IHN0cmluZykge1xuICAgIGlmIChmcy5leGlzdHNTeW5jKHBhdGgpKSB7XG4gICAgICAgIGZvcmNlUm1EaXIocGF0aCk7XG4gICAgfVxuICAgIGZzLm1rZGlyU3luYyhwYXRoLCAoeyByZWN1cnNpdmU6IHRydWUgfTogYW55KSk7XG59XG5cbmV4cG9ydCB0eXBlIFBhdGhKb2luID0gKC4uLml0ZW1zOiBzdHJpbmdbXSkgPT4gc3RyaW5nO1xuXG5mdW5jdGlvbiBqb2luKGJhc2U6IHN0cmluZywgaXRlbTogc3RyaW5nLCBzZXBhcmF0b3I6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgYmFzZVdpdGhTZXAgPSBiYXNlLmVuZHNXaXRoKHNlcGFyYXRvcik7XG4gICAgY29uc3QgaXRlbVdpdGhTZXAgPSBpdGVtLnN0YXJ0c1dpdGgoc2VwYXJhdG9yKTtcbiAgICBpZiAoYmFzZVdpdGhTZXAgJiYgaXRlbVdpdGhTZXApIHtcbiAgICAgICAgcmV0dXJuIGAke2Jhc2V9JHtpdGVtLnN1YnN0cigxKX1gO1xuICAgIH1cbiAgICBpZiAoIWJhc2VXaXRoU2VwICYmICFpdGVtV2l0aFNlcCkge1xuICAgICAgICByZXR1cm4gYCR7YmFzZX0vJHtpdGVtfWA7XG4gICAgfVxuICAgIHJldHVybiBgJHtiYXNlfSR7aXRlbX1gO1xufVxuXG5mdW5jdGlvbiBiaW5kUGF0aEpvaW5UbyhiYXNlOiBzdHJpbmcsIHNlcGFyYXRvcj86IHN0cmluZyk6IFBhdGhKb2luIHtcbiAgICBpZiAoc2VwYXJhdG9yKSB7XG4gICAgICAgIGNvbnN0IHNlcCA9IHNlcGFyYXRvcjtcbiAgICAgICAgcmV0dXJuICguLi5pdGVtczogc3RyaW5nW10pOiBzdHJpbmcgPT4ge1xuICAgICAgICAgICAgbGV0IHBhdGggPSBiYXNlO1xuICAgICAgICAgICAgaXRlbXMuZm9yRWFjaCh4ID0+IHBhdGggPSBqb2luKHBhdGgsIHgsIHNlcCkpO1xuICAgICAgICAgICAgcmV0dXJuIHBhdGg7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuICguLi5pdGVtczogc3RyaW5nW10pOiBzdHJpbmcgPT4ge1xuICAgICAgICByZXR1cm4gaXRlbXMubGVuZ3RoID4gMCA/IHBhdGguam9pbihiYXNlLCAuLi5pdGVtcykgOiBiYXNlO1xuICAgIH1cbn1cblxuXG5mdW5jdGlvbiBpbnB1dExpbmUoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgY29uc3Qgc3RhbmRhcmRfaW5wdXQgPSBwcm9jZXNzLnN0ZGluO1xuICAgICAgICBzdGFuZGFyZF9pbnB1dC5zZXRFbmNvZGluZygndXRmLTgnKTtcbiAgICAgICAgc3RhbmRhcmRfaW5wdXQub25jZSgnZGF0YScsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICByZXNvbHZlKGAke2RhdGF9YC50cmltKCkpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gYnJlYWtXb3JkcyhzOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHdvcmRzID0gcy5zcGxpdCgnICcpO1xuICAgIGxldCByZXN1bHQgPSAnJztcbiAgICBsZXQgbGluZSA9ICcnO1xuICAgIHdvcmRzLmZvckVhY2goKHcpID0+IHtcbiAgICAgICAgaWYgKGxpbmUubGVuZ3RoICsgdy5sZW5ndGggPiA4MCkge1xuICAgICAgICAgICAgaWYgKHJlc3VsdCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gJ1xcbic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHQgKz0gbGluZTtcbiAgICAgICAgICAgIGxpbmUgPSAnJztcbiAgICAgICAgfVxuICAgICAgICBpZiAobGluZSAhPT0gJycpIHtcbiAgICAgICAgICAgIGxpbmUgKz0gJyAnO1xuICAgICAgICB9XG4gICAgICAgIGxpbmUgKz0gdztcbiAgICB9KTtcbiAgICBpZiAobGluZSAhPT0gJycpIHtcbiAgICAgICAgaWYgKHJlc3VsdCAhPT0gJycpIHtcbiAgICAgICAgICAgIHJlc3VsdCArPSAnXFxuJztcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQgKz0gbGluZTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cblxuXG5jb25zdCBodHRwcyA9IHJlcXVpcmUoJ2h0dHBzJyk7XG5cbmZ1bmN0aW9uIGh0dHBzR2V0SnNvbih1cmw6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPCpbXT4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBjb25zdCB0cnlVcmwgPSAodXJsKSA9PiB7XG4gICAgICAgICAgICBodHRwcy5nZXQodXJsLCBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgICAgbGV0IGJvZHkgPSAnJztcblxuICAgICAgICAgICAgICAgIHJlcy5vbignZGF0YScsIGZ1bmN0aW9uIChjaHVuaykge1xuICAgICAgICAgICAgICAgICAgICBib2R5ICs9IGNodW5rO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmVzLm9uKCdlbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzQ29kZSA9PT0gMzAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWRpcmVjdFVybCA9IHJlcy5oZWFkZXJzWydsb2NhdGlvbiddO1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5VXJsKHJlZGlyZWN0VXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IEpTT04ucGFyc2UoYm9keSk7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSkub24oJ2Vycm9yJywgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0cnlVcmwodXJsKTtcbiAgICB9KVxufVxuXG5mdW5jdGlvbiB0b0lkZW50aWZpZXIoczogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBsZXQgaWRlbnRpZmllciA9ICcnO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBjb25zdCBjID0gc1tpXTtcbiAgICAgICAgY29uc3QgaXNMZXR0ZXIgPSBjLnRvTG93ZXJDYXNlKCkgIT09IGMudG9VcHBlckNhc2UoKTtcbiAgICAgICAgY29uc3QgaXNEaWdpdCA9ICFpc0xldHRlciAmJiAnMDEyMzQ1Njc4OScuaW5jbHVkZXMoYyk7XG4gICAgICAgIGlmIChpc0xldHRlciB8fCBpc0RpZ2l0KSB7XG4gICAgICAgICAgICBpZGVudGlmaWVyICs9IGM7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGlkZW50aWZpZXI7XG59XG5cbmNvbnN0IHVzZXJJZGVudGlmaWVyID0gdG9JZGVudGlmaWVyKG9zLnVzZXJJbmZvKCkudXNlcm5hbWUpLnRvTG93ZXJDYXNlKCk7XG5jb25zdCB0b25sYWJzSG9tZVBhdGggPSBiaW5kUGF0aEpvaW5UbyhwYXRoLmpvaW4ob3MuaG9tZWRpcigpLCAnLnRvbmxhYnMnKSk7XG5cbmZ1bmN0aW9uIHByb2dyZXNzKGluZm86IHN0cmluZykge1xuICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKGAke2luZm99Li4uYCk7XG59XG5cbmZ1bmN0aW9uIHByb2dyZXNzRG9uZSgpIHtcbiAgICBjb25zb2xlLmxvZygnIOKckycpO1xufVxuXG5leHBvcnQgdHlwZSBGaWxlQXJnID0ge1xuICAgIGRpcjogUGF0aEpvaW4sXG4gICAgYmFzZTogc3RyaW5nLFxuICAgIG5hbWU6IHN0cmluZ1xufVxuXG5mdW5jdGlvbiBwYXJzZUZpbGVBcmcoZmlsZUFyZzogc3RyaW5nLCBleHQ6IHN0cmluZyk6IEZpbGVBcmcge1xuICAgIGlmIChvcy5wbGF0Zm9ybSgpID09PSAnZGFyd2luJyAmJiBmaWxlQXJnLnN0YXJ0c1dpdGgoJ34vJykpIHtcbiAgICAgICAgZmlsZUFyZyA9IHBhdGguam9pbihvcy5ob21lZGlyKCksIGZpbGVBcmcuc3Vic3RyKDIpKTtcbiAgICB9XG4gICAgY29uc3QgZmlsZVBhdGggPSBwYXRoLnJlc29sdmUoZmlsZUFyZyk7XG4gICAgY29uc3QgZGlyID0gYmluZFBhdGhKb2luVG8ocGF0aC5kaXJuYW1lKGZpbGVQYXRoKSk7XG4gICAgY29uc3QgYmFzZSA9IHBhdGguYmFzZW5hbWUoZmlsZVBhdGgsIGV4dCk7XG4gICAgY29uc3QgbmFtZSA9IGJhc2UuaW5jbHVkZXMoJy4nKSA/IGJhc2UgOiBgJHtiYXNlfSR7ZXh0fWA7XG4gICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgICBkaXIsXG4gICAgICAgIGJhc2UsXG4gICAgICAgIG5hbWVcbiAgICB9O1xuICAgIGlmICghZnMuZXhpc3RzU3luYyhyZXN1bHQuZGlyKG5hbWUpKSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKHRleHRzLnNvdXJjZUZpbGVOb3RGb3VuZChuYW1lKSk7XG4gICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cblxuXG5cbmV4cG9ydCB7XG4gICAgdmVyc2lvbixcbiAgICBzaG93VXNhZ2UsXG4gICAgcnVuLFxuICAgIHZlcnNpb25Ub051bWJlcixcbiAgICBmb3JjZVJtRGlyLFxuICAgIGVuc3VyZUNsZWFuRGlyZWN0b3J5LFxuICAgIGJpbmRQYXRoSm9pblRvLFxuICAgIGlucHV0TGluZSxcbiAgICBicmVha1dvcmRzLFxuICAgIGh0dHBzR2V0SnNvbixcbiAgICB0b0lkZW50aWZpZXIsXG4gICAgdXNlcklkZW50aWZpZXIsXG4gICAgdG9ubGFic0hvbWVQYXRoLFxuICAgIHByb2dyZXNzLFxuICAgIHByb2dyZXNzRG9uZSxcbiAgICBwYXJzZUZpbGVBcmcsXG59XG4iXX0=